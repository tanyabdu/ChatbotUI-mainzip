"use strict";var g=Object.create;var d=Object.defineProperty;var u=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var x=Object.getPrototypeOf,y=Object.prototype.hasOwnProperty;var $=(t,e,i,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of S(e))!y.call(t,s)&&s!==i&&d(t,s,{get:()=>e[s],enumerable:!(o=u(e,s))||o.enumerable});return t};var p=(t,e,i)=>(i=t!=null?g(x(t)):{},$(e||!t||!t.__esModule?d(i,"default",{value:t,enumerable:!0}):i,t));var l=p(require("express"),1),h=require("http"),c=p(require("path"),1),a=p(require("fs"),1),r=(0,l.default)(),_=(0,h.createServer)(r),n=c.default.join(__dirname,"public");console.log(`[prod] __dirname: ${__dirname}`);console.log(`[prod] Static files path: ${n}`);console.log(`[prod] Path exists: ${a.default.existsSync(n)}`);a.default.existsSync(n)&&console.log(`[prod] Files in public: ${a.default.readdirSync(n).join(", ")}`);var f=!1;r.get("/health",(t,e)=>{e.status(200).send("OK")});r.get("/__healthcheck",(t,e)=>{e.status(200).send("OK")});r.use(l.default.static(n));r.get("*",(t,e,i)=>{if(t.path.startsWith("/api"))return f?i():e.status(503).json({error:"Server starting..."});let o=c.default.join(n,"index.html");a.default.existsSync(o)?e.sendFile(o):e.status(500).send(`index.html not found at ${o}. __dirname: ${__dirname}`)});var m=parseInt(process.env.PORT||"5000",10);_.listen(m,"0.0.0.0",()=>{console.log(`[prod] Server listening on port ${m}`),v()});async function v(){try{console.log("[prod] Starting app initialization...");let t=Date.now(),{initializeApp:e}=await import("./app-init.cjs");await e(_,r),f=!0;let i=Date.now()-t;console.log(`[prod] App fully initialized in ${i}ms`)}catch(t){console.error("[prod] Failed to initialize app:",t),process.exit(1)}}

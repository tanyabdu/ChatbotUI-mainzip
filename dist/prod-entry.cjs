"use strict";var u=Object.create;var d=Object.defineProperty;var S=Object.getOwnPropertyDescriptor;var x=Object.getOwnPropertyNames;var y=Object.getPrototypeOf,v=Object.prototype.hasOwnProperty;var $=(t,e,i,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of x(e))!v.call(t,r)&&r!==i&&d(t,r,{get:()=>e[r],enumerable:!(o=S(e,r))||o.enumerable});return t};var p=(t,e,i)=>(i=t!=null?u(y(t)):{},$(e||!t||!t.__esModule?d(i,"default",{value:t,enumerable:!0}):i,t));var l=p(require("express"),1),f=require("http"),c=p(require("path"),1),a=p(require("fs"),1),n=(0,l.default)(),m=(0,f.createServer)(n),s=c.default.resolve(process.cwd(),"dist","public");console.log(`[prod] Static files path: ${s}`);console.log(`[prod] Path exists: ${a.default.existsSync(s)}`);a.default.existsSync(s)&&console.log(`[prod] Files in public: ${a.default.readdirSync(s).join(", ")}`);var g=!1;n.get("/health",(t,e)=>{e.status(200).send("OK")});n.get("/__healthcheck",(t,e)=>{e.status(200).send("OK")});n.use(l.default.static(s));n.get("*",(t,e,i)=>{if(t.path.startsWith("/api"))return g?i():e.status(503).json({error:"Server starting..."});let o=c.default.join(s,"index.html");console.log(`[prod] Serving index.html from: ${o}`),a.default.existsSync(o)?e.sendFile(o):e.status(500).send(`index.html not found at ${o}`)});var h=parseInt(process.env.PORT||"5000",10);m.listen(h,"0.0.0.0",()=>{console.log(`[prod] Server listening on port ${h}`),w()});async function w(){try{console.log("[prod] Starting app initialization...");let t=Date.now(),{initializeApp:e}=await import("./app-init.cjs");await e(m,n),g=!0;let i=Date.now()-t;console.log(`[prod] App fully initialized in ${i}ms`)}catch(t){console.error("[prod] Failed to initialize app:",t),process.exit(1)}}

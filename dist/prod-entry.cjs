"use strict";var f=Object.create;var l=Object.defineProperty;var y=Object.getOwnPropertyDescriptor;var v=Object.getOwnPropertyNames;var S=Object.getPrototypeOf,w=Object.prototype.hasOwnProperty;var z=(t,e,i,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of v(e))!w.call(t,r)&&r!==i&&l(t,r,{get:()=>e[r],enumerable:!(a=y(e,r))||a.enumerable});return t};var o=(t,e,i)=>(i=t!=null?f(S(t)):{},z(e||!t||!t.__esModule?l(i,"default",{value:t,enumerable:!0}):i,t));var p=o(require("express"),1),d=require("http"),n=o(require("path"),1),s=(0,p.default)(),h=(0,d.createServer)(s),u=!1;s.get("/health",(t,e)=>{e.status(200).send("OK")});s.get("/__healthcheck",(t,e)=>{e.status(200).send("OK")});s.use((t,e,i)=>{if(u)return i();if(t.path.startsWith("/api"))return e.status(503).json({error:"Server starting..."});e.status(200).send("<!DOCTYPE html><html><head><meta charset='utf-8'><title>Loading...</title></head><body>Starting...</body></html>")});var c=parseInt(process.env.PORT||"5000",10);h.listen(c,"0.0.0.0",()=>{console.log(`[prod] Server listening on port ${c}`),b()});async function b(){try{console.log("[prod] Starting async app initialization...");let t=Date.now(),e=n.default.resolve(process.cwd(),"dist","public");s.use(p.default.static(e)),s.get("*",(r,m,g)=>{if(r.path.startsWith("/api"))return g();m.sendFile(n.default.join(e,"index.html"))});let{initializeApp:i}=await import("./app-init.cjs");await i(h,s),u=!0;let a=Date.now()-t;console.log(`[prod] App fully initialized in ${a}ms`)}catch(t){console.error("[prod] Failed to initialize app:",t),process.exit(1)}}

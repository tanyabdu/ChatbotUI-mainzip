import OpenAI from "openai";

let client: OpenAI | null = null;

function getClient(): OpenAI {
  if (!client) {
    client = new OpenAI({
      baseURL: "https://api.deepseek.com/v1",
      apiKey: process.env.DEEPSEEK_API_KEY,
    });
  }
  return client;
}

export interface ContentGenerationInput {
  goal: "sale" | "engagement";
  niche: string;
  days: number;
  product?: string;
  strategy?: "general" | "launch";
  gender?: "female" | "male";
  archetype?: {
    name: string;
    description: string;
    recommendations: string[];
    triggerWords?: string[];
    contentStyle?: string[];
    tone?: string;
  };
}

export interface FormatContent {
  content: string;
  hashtags: string[];
}

export interface GeneratedContentDay {
  day: number;
  idea: string;
  type: string;
  post: FormatContent;
  carousel: FormatContent;
  reels: FormatContent;
  stories: FormatContent;
}

const REELS_HOOK_FORMULAS = [
  "–®–æ–∫-—Ñ–∞–∫—Ç: –Ω–∞—á–Ω–∏ —Å –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏–ª–∏ —Ñ–∞–∫—Ç–∞",
  "–ü—Ä–æ–≤–æ–∫–∞—Ü–∏—è: –∑–∞—è–≤–∏ —á—Ç–æ-—Ç–æ —Å–ø–æ—Ä–Ω–æ–µ, —á—Ç–æ –∑–∞—Å—Ç–∞–≤–∏—Ç –¥–æ—Å–º–æ—Ç—Ä–µ—Ç—å",
  "–î–æ/–ü–æ—Å–ª–µ: –ø–æ–∫–∞–∂–∏ –∫–æ–Ω—Ç—Ä–∞—Å—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞",
  "–ú–∏—Ñ/–ü—Ä–∞–≤–¥–∞: —Ä–∞–∑–±–µ–π –ø–æ–ø—É–ª—è—Ä–Ω–æ–µ –∑–∞–±–ª—É–∂–¥–µ–Ω–∏–µ",
  "–ò—Å—Ç–æ—Ä–∏—è –∫–ª–∏–µ–Ω—Ç–∫–∏: –Ω–∞—á–Ω–∏ —Å '–û–Ω–∞ –ø—Ä–∏—à–ª–∞ –∫–æ –º–Ω–µ —Å...'",
  "–í–æ–ø—Ä–æ—Å –≤ –ª–æ–±: '–ê —Ç—ã —Ç–æ–∂–µ —Ç–∞–∫ –¥–µ–ª–∞–µ—à—å?'",
  "–°–µ–∫—Ä–µ—Ç: '–¢–æ, –æ —á—ë–º –Ω–µ –≥–æ–≤–æ—Ä—è—Ç –≤—Å–ª—É—Ö...'",
  "–û—à–∏–±–∫–∞: '3 –æ—à–∏–±–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–≤–µ—Ä—à–∞—é—Ç 90%...'",
  "–ü—Ä–∏–∑–Ω–∞–Ω–∏–µ: '–Ø —Å–∞–º–∞ —á–µ—Ä–µ–∑ —ç—Ç–æ –ø—Ä–æ—à–ª–∞...'",
  "–ò–Ω—Ç—Ä–∏–≥–∞: '–î–æ—Å–º–æ—Ç—Ä–∏ –¥–æ –∫–æ–Ω—Ü–∞, —Ç–∞–º –≥–ª–∞–≤–Ω–æ–µ'",
  "–°–ø–∏—Å–æ–∫: '–¢–æ–ø-5 –ø—Ä–∏—á–∏–Ω –ø–æ—á–µ–º—É...'",
  "–°—Ä–∞–≤–Ω–µ–Ω–∏–µ: '–†–∞–Ω—å—à–µ —è –¥—É–º–∞–ª–∞ X, —Ç–µ–ø–µ—Ä—å –ø–æ–Ω–∏–º–∞—é Y'",
  "–ë–æ–ª—å: '–ï—Å–ª–∏ —Ç—ã —á—É–≤—Å—Ç–≤—É–µ—à—å [–±–æ–ª—å], —ç—Ç–æ –¥–ª—è —Ç–µ–±—è'",
  "–†–µ–∑—É–ª—å—Ç–∞—Ç: '–ó–∞ 2 –Ω–µ–¥–µ–ª–∏ –æ–Ω–∞ —Å–º–æ–≥–ª–∞...'",
  "POV: 'POV: —Ç—ã –Ω–∞–∫–æ–Ω–µ—Ü-—Ç–æ —Ä–µ—à–∏–ª–∞—Å—å –Ω–∞ [–¥–µ–π—Å—Ç–≤–∏–µ]'",
  "–û–±—Ä–∞—â–µ–Ω–∏–µ: '–≠—Ç–æ –≤–∏–¥–µ–æ –¥–ª—è —Ç–µ—Ö, –∫—Ç–æ —É—Å—Ç–∞–ª –æ—Ç...'",
  "–¢—Ä–∏–≥–≥–µ—Ä: '–ö–æ–≥–¥–∞ –æ–Ω –≥–æ–≤–æ—Ä–∏—Ç [—Ñ—Ä–∞–∑–∞], –∞ —Ç—ã...'",
  "–õ–∞–π—Ñ—Ö–∞–∫: '–ü—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± [—Ä–µ–∑—É–ª—å—Ç–∞—Ç] –∑–∞ 5 –º–∏–Ω—É—Ç'",
  "–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: '–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –¥–µ–ª–∞–π —ç—Ç–æ, –µ—Å–ª–∏ —Ö–æ—á–µ—à—å...'",
  "–ò–Ω—Å–∞–π—Ç: '–ú–µ–Ω—è –æ—Å–µ–Ω–∏–ª–æ, –∫–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç–∫–∞ —Å–∫–∞–∑–∞–ª–∞...'",
  "–ß–µ–ª–ª–µ–Ω–¥–∂: '–ü–æ–ø—Ä–æ–±—É–π —ç—Ç–æ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å'",
  "–†–µ–∞–∫—Ü–∏—è: '–ú–æ—è —Ä–µ–∞–∫—Ü–∏—è, –∫–æ–≥–¥–∞ —É–∑–Ω–∞–ª–∞ —á—Ç–æ...'",
  "–†–∞–∑–æ–±–ª–∞—á–µ–Ω–∏–µ: '–ü—Ä–∞–≤–¥–∞ –æ [—Ç–µ–º–µ], –∫–æ—Ç–æ—Ä—É—é —Å–∫—Ä—ã–≤–∞—é—Ç'",
  "–§–æ—Ä–º—É–ª–∞: '–§–æ—Ä–º—É–ª–∞ [—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞] –∏–∑ 3 —à–∞–≥–æ–≤'",
  "–¶–∏—Ç–∞—Ç–∞ –∫–ª–∏–µ–Ω—Ç–∫–∏: '–û–Ω–∞ —Å–∫–∞–∑–∞–ª–∞ –º–Ω–µ: [—Ü–∏—Ç–∞—Ç–∞]'",
  "–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π –ø–æ–≤–æ—Ä–æ—Ç: –∏—Å—Ç–æ—Ä–∏—è —Å —Å—é—Ä–ø—Ä–∏–∑–æ–º –≤ –∫–æ–Ω—Ü–µ",
  "–ü—Ä—è–º–æ–π —ç—Ñ–∏—Ä —Å—Ç–∏–ª—å: –≥–æ–≤–æ—Ä–∏ –∫–∞–∫ –±—É–¥—Ç–æ –æ—Ç–≤–µ—á–∞–µ—à—å –Ω–∞ –≤–æ–ø—Ä–æ—Å",
  "–ú–∏–Ω–∏-—É—Ä–æ–∫: –æ–±—É—á–∞—é—â–∏–π —Ñ–æ—Ä–º–∞—Ç —Å –ø–æ–ª—å–∑–æ–π",
  "–ó–∞ –∫–∞–¥—Ä–æ–º: –ø–æ–∫–∞–∂–∏ –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã",
  "–û—Ç–≤–µ—Ç —Ö–µ–π—Ç–µ—Ä–∞–º: '–ú–Ω–µ —á–∞—Å—Ç–æ –≥–æ–≤–æ—Ä—è—Ç [–≤–æ–∑—Ä–∞–∂–µ–Ω–∏–µ]...'",
  "–¢—Ä–µ–Ω–¥: –∞–¥–∞–ø—Ç–∏—Ä—É–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –ø–æ–¥ —Ç–µ–º—É",
  "–°—Ç–æ—Ä–∏—Ç–µ–ª–ª–∏–Ω–≥: —Ä–∞—Å—Å–∫–∞–∂–∏ –∏—Å—Ç–æ—Ä–∏—é —Å –º–æ—Ä–∞–ª—å—é",
  "–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è: '–ü—Ä–µ–¥—Å—Ç–∞–≤—å —á—Ç–æ —Ç—ã —É–∂–µ...'",
  "–î–Ω–µ–≤–Ω–∏–∫: '–î–µ–Ω—å –∏–∑ –∂–∏–∑–Ω–∏ [—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞]'",
  "Q&A: –æ—Ç–≤–µ—Ç –Ω–∞ —á–∞—Å—Ç—ã–π –≤–æ–ø—Ä–æ—Å –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤",
  "–†–∞—Å–ø–∞–∫–æ–≤–∫–∞: —Ä–∞–∑–±–æ—Ä —Å–∏—Ç—É–∞—Ü–∏–∏ –ø–æ —à–∞–≥–∞–º",
  "–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞: –Ω–∞—á–Ω–∏ —Å —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è",
  "–ú–µ—Ç–∞—Ñ–æ—Ä–∞: –æ–±—ä—è—Å–Ω–∏ —Å–ª–æ–∂–Ω–æ–µ —á–µ—Ä–µ–∑ –ø—Ä–æ—Å—Ç–æ–π –æ–±—Ä–∞–∑",
  "–ö–æ–Ω—Ç—Ä–∞—Å—Ç: '–í—Å–µ –≥–æ–≤–æ—Ä—è—Ç X, –∞ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ Y'",
  "–õ–∏—á–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è: —Ä–∞—Å—Å–∫–∞–∂–∏ —Å–≤–æ–π –æ–ø—ã—Ç",
  "–°—Ä–æ—á–Ω–æ—Å—Ç—å: '–≠—Ç–æ –Ω—É–∂–Ω–æ —É—Å–ª—ã—à–∞—Ç—å –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å'",
  "–û—Ç–∫—Ä–æ–≤–µ–Ω–∏–µ: '–ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–ª–∞ —ç—Ç–æ –ø—É–±–ª–∏—á–Ω–æ, –Ω–æ...'",
  "–ü—Ä–æ–≥–Ω–æ–∑: '–ß–µ—Ä–µ–∑ –º–µ—Å—è—Ü —Ç—ã –±—É–¥–µ—à—å –∂–∞–ª–µ—Ç—å, –µ—Å–ª–∏ –Ω–µ...'",
  "–¢–µ—Å—Ç –Ω–∞ —Å–µ–±–µ: '–ü—Ä–æ–≤–µ—Ä–∏–ª–∞ –Ω–∞ —Å–µ–±–µ –∏ –≤–æ—Ç —á—Ç–æ –≤—ã—à–ª–æ'",
  "–ê–Ω—Ç–∏–ø—Ä–∏–º–µ—Ä: '–ö–∞–∫ –¥–µ–ª–∞—Ç—å –ù–ï –Ω–∞–¥–æ (–Ω–∞ –ø—Ä–∏–º–µ—Ä–µ –∫–ª–∏–µ–Ω—Ç–∫–∏)'",
  "–ü–æ—à–∞–≥–æ–≤–∫–∞: '3 —à–∞–≥–∞ –∫ [—Ä–µ–∑—É–ª—å—Ç–∞—Ç—É], –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–±–æ—Ç–∞—é—Ç'",
  "–°–µ—Ä–∏–∞–ª: '–ß–∞—Å—Ç—å 1: –∏—Å—Ç–æ—Ä–∏—è, –∫–æ—Ç–æ—Ä–∞—è –∏–∑–º–µ–Ω–∏—Ç —Ç–≤–æ–π –≤–∑–≥–ª—è–¥'",
  "–û–ø—Ä–æ–≤–µ—Ä–∂–µ–Ω–∏–µ: '–í—Å–µ –¥—É–º–∞—é—Ç —á—Ç–æ [–º–∏—Ñ], –Ω–æ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ...'",
  "–ù–∞–±–ª—é–¥–µ–Ω–∏–µ –∑–∞ —Å–æ–±–æ–π: '–ü–æ–π–º–∞–ª–∞ —Å–µ–±—è –Ω–∞ —Ç–æ–º, —á—Ç–æ...'",
  "–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: '–î–µ–ª–∞–π —ç—Ç–æ –∫–∞–∂–¥–æ–µ —É—Ç—Ä–æ –∏ —É–≤–∏–¥–∏—à—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç'",
  "–í—ã–∑–æ–≤: '–°–ø–æ—Ä–∏–º, —Ç—ã –Ω–µ –∑–Ω–∞–ª–∞ —ç—Ç–æ –æ —Å–µ–±–µ?'",
  "–†–∞–∑–±–æ—Ä –æ—à–∏–±–æ–∫: '–ü–æ—á–µ–º—É —É —Ç–µ–±—è –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è [—Ü–µ–ª—å]'",
  "–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è: '–ë—ã–ª–∞ —Ç–∞–∫–æ–π, —Å—Ç–∞–ª–∞ –¥—Ä—É–≥–æ–π ‚Äî –≤–æ—Ç —á—Ç–æ –∏–∑–º–µ–Ω–∏–ª–∞'"
];

const STORIES_HOOK_FORMULAS = [
  "–û–ø—Ä–æ—Å: '–ó–Ω–∞–∫–æ–º–æ —Ç–µ–±–µ —ç—Ç–æ —á—É–≤—Å—Ç–≤–æ?' —Å –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ–º",
  "–¢–µ—Å—Ç: '–ü—Ä–æ–≤–µ—Ä—å —Å–µ–±—è ‚Äî —É–∑–Ω–∞–µ—à—å –ª–∏ —Ç—ã...'",
  "–í–æ–ø—Ä–æ—Å –¥–Ω—è: –æ—Ç–∫—Ä—ã—Ç—ã–π –≤–æ–ø—Ä–æ—Å –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤",
  "–£–≥–∞–¥–∞–π–∫–∞: '–ö–∞–∫ –¥—É–º–∞–µ—à—å, —á—Ç–æ –æ–Ω–∞ —Å–¥–µ–ª–∞–ª–∞?'",
  "–°–ª–∞–π–¥–µ—Ä —ç–º–æ—Ü–∏–π: '–ù–∞—Å–∫–æ–ª—å–∫–æ —ç—Ç–æ –ø—Ä–æ —Ç–µ–±—è?'",
  "–í–∏–∫—Ç–æ—Ä–∏–Ω–∞: —Å–µ—Ä–∏—è –≤–æ–ø—Ä–æ—Å–æ–≤ —Å –æ—Ç–≤–µ—Ç–∞–º–∏",
  "–û–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á—ë—Ç: '–û—Å—Ç–∞–ª–æ—Å—å 3 –¥–Ω—è –¥–æ...'",
  "–ó–∞ –∫—É–ª–∏—Å–∞–º–∏: –ø–æ–∫–∞–∂–∏ —Ä–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å",
  "–î–æ/–ü–æ—Å–ª–µ: –≤–∏–∑—É–∞–ª—å–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ",
  "–¶–∏—Ç–∞—Ç–∞ –¥–Ω—è: –º–æ—Ç–∏–≤–∏—Ä—É—é—â–∞—è –º—ã—Å–ª—å",
  "–ü—Ä–∏–∑–Ω–∞–Ω–∏–µ: '–ß–µ—Å—Ç–Ω–æ? –Ø —Ç–æ–∂–µ —á–µ—Ä–µ–∑ —ç—Ç–æ –ø—Ä–æ—à–ª–∞'",
  "–°–æ–≤–µ—Ç –¥–Ω—è: –æ–¥–Ω–∞ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è",
  "–û—à–∏–±–∫–∞ –¥–Ω—è: '–ù–µ –¥–µ–ª–∞–π —Ç–∞–∫, –µ—Å–ª–∏ —Ö–æ—á–µ—à—å...'",
  "–ò–Ω—Å–∞–π—Ç: –∫–æ—Ä–æ—Ç–∫–æ–µ –æ–∑–∞—Ä–µ–Ω–∏–µ –∏–∑ –ø—Ä–∞–∫—Ç–∏–∫–∏",
  "–í–æ–ø—Ä–æ—Å-–æ—Ç–≤–µ—Ç: –æ—Ç–≤–µ—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å –ø–æ–¥–ø–∏—Å—á–∏–∫–∞",
  "–ú–∏–Ω–∏-–∏—Å—Ç–æ—Ä–∏—è: —Å–µ—Ä–∏—è —Å—Ç–æ—Ä–∏—Å —Å —Ä–∞–∑–≤–∏—Ç–∏–µ–º",
  "–ß–µ–∫-–ª–∏—Å—Ç: '–ü—Ä–æ–≤–µ—Ä—å —Å–µ–±—è –ø–æ –ø—É–Ω–∫—Ç–∞–º'",
  "–õ–∞–π—Ñ—Ö–∞–∫: –±—ã—Å—Ç—Ä—ã–π –ø–æ–ª–µ–∑–Ω—ã–π —Å–æ–≤–µ—Ç",
  "–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ: '–°–µ–≥–æ–¥–Ω—è —É –º–µ–Ω—è —Ç–∞–∫–æ–µ —É—Ç—Ä–æ...'",
  "–ê–Ω–æ–Ω—Å: '–°–∫–æ—Ä–æ —Ä–∞—Å—Å–∫–∞–∂—É –æ...'",
  "–ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å: '–°–ø–∞—Å–∏–±–æ –≤–∞–º –∑–∞...'",
  "–†–µ—Ñ–ª–µ–∫—Å–∏—è: '–ó–∞–¥—É–º–∞–ª–∞—Å—å —Å–µ–≥–æ–¥–Ω—è –æ...'",
  "–ü—Ä–æ–≤–æ–∫–∞—Ü–∏—è: '–ê –∫–∞–∫ —Ç—ã –æ—Ç–Ω–æ—Å–∏—à—å—Å—è –∫...'",
  "–°–µ–∫—Ä–µ—Ç: '–ú–∞–ª–æ –∫—Ç–æ –∑–Ω–∞–µ—Ç, –Ω–æ...'",
  "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: '–ü–æ–ø—Ä–æ–±—É–π —ç—Ç–æ –Ω–∞ –≤—ã—Ö–æ–¥–Ω—ã—Ö'",
  "–ú–æ—Ç–∏–≤–∞—Ü–∏—è: '–ù–∞–ø–æ–º–∏–Ω–∞—é —Ç–µ–±–µ, —á—Ç–æ —Ç—ã...'",
  "–°—Ä–∞–≤–Ω–µ–Ω–∏–µ: '–ß—Ç–æ –≤—ã–±–∏—Ä–∞–µ—à—å: –ê –∏–ª–∏ –ë?'",
  "–†–µ–∞–∫—Ü–∏—è: '–ú–æ—ë –ª–∏—Ü–æ, –∫–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç–∫–∞ —Å–∫–∞–∑–∞–ª–∞...'",
  "–ü—Ä–æ—Ü–µ—Å—Å: '–ü–æ–∫–∞–∑—ã–≤–∞—é –∫–∞–∫ —è –¥–µ–ª–∞—é...'",
  "–†–µ–∑—É–ª—å—Ç–∞—Ç: '–í–æ—Ç —á—Ç–æ –ø–æ–ª—É—á–∏–ª–æ—Å—å —É –∫–ª–∏–µ–Ω—Ç–∫–∏'",
  "–í–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ: '–≠—Ç–æ —Ñ–æ—Ç–æ –Ω–∞–ø–æ–º–Ω–∏–ª–æ –º–Ω–µ –æ...'",
  "–ü–ª–∞–Ω—ã: '–ù–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ —Ö–æ—á—É...'",
  "–í–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–µ: '–ì–æ–¥ –Ω–∞–∑–∞–¥ —è –±—ã–ª–∞ –≤ —Ç–æ–π –∂–µ —Å–∏—Ç—É–∞—Ü–∏–∏'",
  "–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç: '–ü–æ–ø—Ä–æ–±–æ–≤–∞–ª–∞ –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥ –∏...'",
  "–û—Ç–∑—ã–≤: '–ö–ª–∏–µ–Ω—Ç–∫–∞ –Ω–∞–ø–∏—Å–∞–ª–∞ –º–Ω–µ –≤—á–µ—Ä–∞...'",
  "–ù–∞–±–ª—é–¥–µ–Ω–∏–µ: '–ó–∞–º–µ—Ç–∏–ª–∞ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—É—é –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç—å'",
  "–§–æ—Ä–º–∞—Ç '—ç—Ç–æ –∏–ª–∏ —Ç–æ': –≤—ã–±–æ—Ä –º–µ–∂–¥—É –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏",
  "–î–Ω–µ–≤–Ω–∏–∫: '–ú–æ–π –¥–µ–Ω—å —Å–µ–≥–æ–¥–Ω—è –Ω–∞—á–∞–ª—Å—è —Å...'",
  "–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: '–ù–µ –∑–∞–±—É–¥—å —Å–µ–≥–æ–¥–Ω—è...'",
  "–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ: '–ü—Ä–∏—Ö–æ–¥–∏ –Ω–∞ [—Å–æ–±—ã—Ç–∏–µ]'",
  "–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ: '–ü–æ–º–æ–≥–∏ –º–Ω–µ –≤—ã–±—Ä–∞—Ç—å ‚Äî –ê –∏–ª–∏ –ë?'",
  "–†–∞–∑–æ–±–ª–∞—á–µ–Ω–∏–µ –º–∏—Ñ–∞: '–í—Å–µ –≤–µ—Ä—è—Ç –≤ —ç—Ç–æ, –Ω–æ —ç—Ç–æ –Ω–µ–ø—Ä–∞–≤–¥–∞'",
  "–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å: '–ß—Ç–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ —É–∑–Ω–∞—Ç—å? –ü–∏—à–∏—Ç–µ!'",
  "–ò–Ω—Å–∞–π—Ç –∫–ª–∏–µ–Ω—Ç–∫–∏: '–í—á–µ—Ä–∞ –∫–ª–∏–µ–Ω—Ç–∫–∞ —Å–∫–∞–∑–∞–ª–∞ —Ñ—Ä–∞–∑—É, –∫–æ—Ç–æ—Ä–∞—è...'",
  "–ú–∏–Ω–∏-—É—Ä–æ–∫: '–°–µ–≥–æ–¥–Ω—è –ø–æ–∫–∞–∂—É –æ–¥–Ω—É —Ç–µ—Ö–Ω–∏–∫—É –∑–∞ 30 —Å–µ–∫'",
  "–†–µ—Ç—Ä–æ—Å–ø–µ–∫—Ç–∏–≤–∞: '–ß—Ç–æ —è –ø–æ–Ω—è–ª–∞ –∑–∞ –≥–æ–¥ —Ä–∞–±–æ—Ç—ã'",
  "–ü—è—Ç–Ω–∏—á–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç: '–õ—ë–≥–∫–∏–π –ø–æ—Å—Ç –Ω–∞ –≤—ã—Ö–æ–¥–Ω—ã–µ'",
  "–£—Ç—Ä–µ–Ω–Ω—è—è —Ä—É—Ç–∏–Ω–∞: '–ú–æ—ë —É—Ç—Ä–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å...'",
  "–õ–∏—á–Ω—ã–π —Ñ–∞–∫—Ç: '–ú–∞–ª–æ –∫—Ç–æ –∑–Ω–∞–µ—Ç, –Ω–æ —è...'",
  "–ü—Ä—è–º–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ: '–ï—Å–ª–∏ —Ç—ã —Å–µ–π—á–∞—Å –≤ [—Å–∏—Ç—É–∞—Ü–∏–∏], —á–∏—Ç–∞–π'",
  "–°—Ä–æ—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: '–í–∞–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è —Ç–µ—Ö, –∫—Ç–æ...'"
];

const CONTENT_STYLES = [
  "—Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–π, –∫–∞–∫ –ø–æ–¥—Ä—É–≥–µ",
  "—ç–∫—Å–ø–µ—Ä—Ç–Ω—ã–π, –Ω–æ –ø—Ä–æ—Å—Ç–æ–π",
  "—ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏ –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–∏–π",
  "–ø—Ä–æ–≤–æ–∫–∞—Ü–∏–æ–Ω–Ω—ã–π –∏ –¥–µ—Ä–∑–∫–∏–π",
  "—Ç—ë–ø–ª—ã–π –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–π",
  "–ø—Ä—è–º–æ–π –∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π",
  "—Å —é–º–æ—Ä–æ–º –∏ —Å–∞–º–æ–∏—Ä–æ–Ω–∏–µ–π",
  "–∑–∞–≥–∞–¥–æ—á–Ω—ã–π –∏ –∏–Ω—Ç—Ä–∏–≥—É—é—â–∏–π"
];

function getRandomElements<T>(array: T[], count: number): T[] {
  const shuffled = [...array].sort(() => Math.random() - 0.5);
  return shuffled.slice(0, Math.min(count, array.length));
}

function fixHashtagsArray(jsonStr: string): string {
  // Find hashtags arrays and fix unquoted values
  // Pattern: "hashtags": [ ... ]
  return jsonStr.replace(/"hashtags"\s*:\s*\[([^\]]*)\]/g, (match, arrayContent) => {
    // Split by comma, but be careful with quoted strings
    const items: string[] = [];
    let current = '';
    let inQuotes = false;
    
    for (const char of arrayContent) {
      if (char === '"' && (current.length === 0 || current[current.length - 1] !== '\\')) {
        inQuotes = !inQuotes;
        current += char;
      } else if (char === ',' && !inQuotes) {
        if (current.trim()) {
          items.push(current.trim());
        }
        current = '';
      } else {
        current += char;
      }
    }
    if (current.trim()) {
      items.push(current.trim());
    }
    
    // Fix each item
    const fixedItems = items.map(item => {
      item = item.trim();
      // Already properly quoted
      if (item.startsWith('"') && item.endsWith('"')) {
        return item;
      }
      // Single quoted - convert to double
      if (item.startsWith("'") && item.endsWith("'")) {
        return `"${item.slice(1, -1)}"`;
      }
      // Unquoted hashtag or text - add quotes
      return `"${item.replace(/"/g, '\\"')}"`;
    });
    
    return `"hashtags": [${fixedItems.join(', ')}]`;
  });
}

// Fix quotes: replace single quotes and Russian quotes with double quotes in JSON
function fixQuotesInJson(jsonStr: string): string {
  // Replace Russian quotes ¬´ ¬ª with standard "
  let fixed = jsonStr.replace(/[¬´¬ª]/g, '"');
  
  // Replace single quotes used as JSON string delimiters
  // Pattern: match property values like 'text' or 'text with "nested" quotes'
  // Be careful not to break apostrophes inside words
  fixed = fixed.replace(/:\s*'([^']*?)'/g, (match, content) => {
    // Escape any double quotes inside the content
    const escaped = content.replace(/"/g, '\\"');
    return `: "${escaped}"`;
  });
  
  // Also fix array values with single quotes
  fixed = fixed.replace(/,\s*'([^']*?)'/g, (match, content) => {
    const escaped = content.replace(/"/g, '\\"');
    return `, "${escaped}"`;
  });
  
  // Fix opening bracket followed by single quote
  fixed = fixed.replace(/\[\s*'([^']*?)'/g, (match, content) => {
    const escaped = content.replace(/"/g, '\\"');
    return `["${escaped}"`;
  });
  
  return fixed;
}

function cleanJsonResponse(content: string): string {
  // Remove markdown code blocks if present
  let cleaned = content.replace(/```json\s*/gi, '').replace(/```\s*/g, '');
  
  // Fix quotes (single, Russian) to standard double quotes
  cleaned = fixQuotesInJson(cleaned);
  
  // Fix hashtags arrays specifically
  cleaned = fixHashtagsArray(cleaned);
  
  // Fix trailing commas before closing brackets
  cleaned = cleaned.replace(/,\s*([}\]])/g, '$1');
  
  return cleaned;
}

function parseContentResponse(content: string): GeneratedContentDay[] {
  // Try to extract JSON array from response
  const jsonMatch = content.match(/\[[\s\S]*\]/);
  if (!jsonMatch) {
    console.error("No JSON array found in response:", content.substring(0, 500));
    throw new Error("Invalid response format from AI");
  }
  
  let jsonStr = jsonMatch[0];
  
  // First attempt: parse as-is
  try {
    return JSON.parse(jsonStr) as GeneratedContentDay[];
  } catch (e) {
    console.log("First parse attempt failed, trying to clean JSON...");
  }
  
  // Second attempt: clean and parse
  try {
    const cleaned = cleanJsonResponse(jsonStr);
    return JSON.parse(cleaned) as GeneratedContentDay[];
  } catch (e) {
    console.log("Second parse attempt failed, trying line-by-line fix...");
  }
  
  // Third attempt: try to fix line by line
  try {
    // More aggressive: try to manually reconstruct valid JSON
    let fixed = jsonStr;
    
    // Fix common issues with hashtags arrays
    // Match "hashtags": [ and everything until ]
    const hashtagPattern = /"hashtags"\s*:\s*\[([^\]]+)\]/g;
    fixed = fixed.replace(hashtagPattern, (match, content) => {
      // Split on commas that are not inside quotes
      const parts = content.split(',').map((p: string) => {
        p = p.trim();
        // Remove leading/trailing whitespace and newlines
        p = p.replace(/^[\s\n]+|[\s\n]+$/g, '');
        
        // If starts with # and not in quotes, quote it
        if (p.startsWith('#') && !p.startsWith('"')) {
          return `"${p}"`;
        }
        // If in quotes, keep as is
        if (p.startsWith('"') && p.endsWith('"')) {
          return p;
        }
        // Otherwise wrap in quotes
        if (p && !p.startsWith('"')) {
          return `"${p}"`;
        }
        return p;
      }).filter((p: string) => p.length > 0);
      
      return `"hashtags": [${parts.join(', ')}]`;
    });
    
    // Remove trailing commas
    fixed = fixed.replace(/,(\s*[}\]])/g, '$1');
    
    return JSON.parse(fixed) as GeneratedContentDay[];
  } catch (e) {
    console.error("All parse attempts failed. Error:", e);
    console.error("Raw content sample:", jsonStr.substring(0, 500));
    throw new Error("Failed to parse AI response as JSON");
  }
}

export async function generateContentStrategy(input: ContentGenerationInput): Promise<GeneratedContentDay[]> {
  const { goal, niche, days, product, strategy, archetype } = input;
  
  const strategyDescription = strategy === "launch"
    ? "–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–ø—É—Å–∫–∞: –ø—Ä–µ–¥–∑–∞–ø—É—Å–∫ ‚Üí –æ—Ç–∫—Ä—ã—Ç–∏–µ ‚Üí –¥–µ–¥–ª–∞–π–Ω—ã ‚Üí –∑–∞–∫—Ä—ã—Ç–∏–µ"
    : "–°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–∏–∫—Å: —ç–∫—Å–ø–µ—Ä—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç + –ª–∏—á–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏–∏ + –º—è–≥–∫–∏–µ –ø—Ä–æ–¥–∞–∂–∏";
    
  const archetypeInstruction = archetype 
    ? `\n\n–î–ù–ö –ë–†–ï–ù–î–ê (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û —É—á–∏—Ç—ã–≤–∞–π –≤ —Å—Ç–∏–ª–µ —Ç–µ–∫—Å—Ç–∞!):
–ê—Ä—Ö–µ—Ç–∏–ø: ${archetype.name}
–û–ø–∏—Å–∞–Ω–∏–µ —Å—Ç–∏–ª—è: ${archetype.description}
${archetype.tone ? `–¢–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å: ${archetype.tone}` : ''}
${archetype.triggerWords?.length ? `–°–ª–æ–≤–∞-—Ç—Ä–∏–≥–≥–µ—Ä—ã (–∏—Å–ø–æ–ª—å–∑—É–π –≤ —Ç–µ–∫—Å—Ç–∞—Ö): ${archetype.triggerWords.slice(0, 10).join(", ")}` : ''}
${archetype.contentStyle?.length ? `–°—Ç–∏–ª—å –∫–æ–Ω—Ç–µ–Ω—Ç–∞: ${archetype.contentStyle.join("; ")}` : ''}
–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –±—Ä–µ–Ω–¥–∞: ${archetype.recommendations.join(", ")}

–í–ê–ñ–ù–û: –ü–∏—à–∏ –≤ —Å—Ç–∏–ª–µ –∞—Ä—Ö–µ—Ç–∏–ø–∞ "${archetype.name}". –ò—Å–ø–æ–ª—å–∑—É–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ç–æ–Ω, —Å–ª–æ–≤–∞-—Ç—Ä–∏–≥–≥–µ—Ä—ã –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ. –ö–æ–Ω—Ç–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –∑–≤—É—á–∞—Ç—å –∫–∞–∫ –±—É–¥—Ç–æ –µ–≥–æ –ø–∏—Å–∞–ª —á–µ–ª–æ–≤–µ–∫ —Å —ç—Ç–∏–º –∞—Ä—Ö–µ—Ç–∏–ø–æ–º.`
    : "";

  // Viral content rules - based on engagement psychology
  const writingStyleRules = `
–ì–õ–ê–í–ù–û–ï –ü–†–ê–í–ò–õ–û: –ü–µ—Ä–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ ‚Äî –ö–†–Æ–ß–û–ö. –ß–µ–ª–æ–≤–µ–∫ –¥–æ–ª–∂–µ–Ω –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–∫—Ä–æ–ª–ª.

–í–ê–ñ–ù–û: –ò—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—é –Ω–∏—à–∏ "${niche}". –ù–ï –¥–æ–±–∞–≤–ª—è–π —ç–ª–µ–º–µ–Ω—Ç—ã –∏–∑ –¥—Ä—É–≥–∏—Ö –Ω–∏—à (—Ç–∞—Ä–æ, –∞—Å—Ç—Ä–æ–ª–æ–≥–∏—è, –Ω—É–º–µ—Ä–æ–ª–æ–≥–∏—è ‚Äî –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ —É–∫–∞–∑–∞–Ω–æ –≤ –Ω–∏—à–µ)!

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
üî• –§–û–†–ú–£–õ–´ –í–ò–†–£–°–ù–´–• –•–£–ö–û–í (–∞–¥–∞–ø—Ç–∏—Ä—É–π –ø–æ–¥ –Ω–∏—à—É "${niche}"):
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

1. –®–û–ö/–ö–û–ù–¢–†–û–í–ï–†–°–ò–Ø:
   "–ü–æ—á–µ–º—É —è –±–æ–ª—å—à–µ –Ω–µ –¥–∞—é —ç—Ç–æ—Ç —Å–æ–≤–µ—Ç –∫–ª–∏–µ–Ω—Ç–∫–∞–º"
   "–Ø –ø–æ—Ç–µ—Ä—è–ª–∞ 50 –∫–ª–∏–µ–Ω—Ç–æ–≤ –∑–∞ –º–µ—Å—è—Ü. –ò —ç—Ç–æ –ª—É—á—à–µ–µ, —á—Ç–æ —Å–ª—É—á–∏–ª–æ—Å—å"
   "3 –≤–µ—â–∏, –∫–æ—Ç–æ—Ä—ã–µ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã —Å–∫—Ä—ã–≤–∞—é—Ç –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤"

2. –£–ó–ù–ê–í–ê–ù–ò–ï –°–ï–ë–Ø:
   "–ï—Å–ª–∏ —Ç—ã —É–∑–Ω–∞—ë—à—å —Å–µ–±—è –≤ —ç—Ç–æ–º ‚Äî —á–∏—Ç–∞–π –¥–∞–ª—å—à–µ"
   "–¢—ã –¥–µ–ª–∞–µ—à—å —ç—Ç–æ –∫–∞–∂–¥–æ–µ —É—Ç—Ä–æ. –ò —Ç–µ—Ä—è–µ—à—å —ç–Ω–µ—Ä–≥–∏—é –¥–æ –≤–µ—á–µ—Ä–∞"
   "90% –∂–µ–Ω—â–∏–Ω –¥–µ–ª–∞—é—Ç —ç—Ç—É –æ—à–∏–±–∫—É –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö"

3. –ù–ï–ó–ê–ö–û–ù–ß–ï–ù–ù–ê–Ø –ú–´–°–õ–¨ (–æ—Ç–∫—Ä—ã—Ç–∞—è –ø–µ—Ç–ª—è):
   "–û–Ω–∞ –¥—É–º–∞–ª–∞, –ø—Ä–æ–±–ª–µ–º–∞ –≤ –º—É–∂–µ. –ù–æ –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –≤—ã—è—Å–Ω–∏–ª–æ—Å—å..."
   "–ï—Å—Ç—å –æ–¥–Ω–∞ —Ñ—Ä–∞–∑–∞, –∫–æ—Ç–æ—Ä–∞—è —É–±–∏–≤–∞–µ—Ç –æ—Ç–Ω–æ—à–µ–Ω–∏—è. –≠—Ç–æ..."
   "90% –ª—é–¥–µ–π –Ω–µ –∑–Ω–∞—é—Ç —ç—Ç–æ–≥–æ –ø—Ä–æ —Å–µ–±—è. –ê —ç—Ç–æ –º–µ–Ω—è–µ—Ç –≤—Å—ë"

4. –°–ü–ò–°–ö–ò –° –¶–ò–§–†–ê–ú–ò:
   "5 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤, —á—Ç–æ –ø–æ—Ä–∞ –º–µ–Ω—è—Ç—å —á—Ç–æ-—Ç–æ –≤ –∂–∏–∑–Ω–∏"
   "3 –æ—à–∏–±–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥–µ–ª–∞—é—Ç –≤—Å–µ"
   "7 —Ñ—Ä–∞–∑, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–∑—Ä—É—à–∞—é—Ç –æ—Ç–Ω–æ—à–µ–Ω–∏—è"

5. –ü–ï–†–°–û–ù–ê–õ–ò–ó–ê–¶–ò–Ø:
   "–ù–∞–ø–∏—à–∏ —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å ‚Äî –æ—Ç–≤–µ—á—É"
   "–ê —É —Ç–µ–±—è —Ç–∞–∫ –±—ã–ª–æ? –†–∞—Å—Å–∫–∞–∂–∏"
   "–ü—Ä–æ–≤–µ—Ä—å —Å–µ–±—è ‚Äî —É–∑–Ω–∞—ë—à—å?"

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
üíæ –¢–†–ò–ì–ì–ï–†–´ –°–û–•–†–ê–ù–ï–ù–ò–ô:
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
- "–°–æ—Ö—Ä–∞–Ω–∏, —á—Ç–æ–±—ã –Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å"
- "–®–ø–∞—Ä–≥–∞–ª–∫–∞ ‚Äî –ø—Ä–∏–≥–æ–¥–∏—Ç—Å—è"
- "–ß–µ–∫–ª–∏—Å—Ç ‚Äî –∑–∞–±–∏—Ä–∞–π"
- –õ—é–±—ã–µ –ø–æ–ª–µ–∑–Ω—ã–µ —Å–ø–∏—Å–∫–∏, –¥–∞—Ç—ã, —á–µ–∫–ª–∏—Å—Ç—ã

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
üí¨ –¢–†–ò–ì–ì–ï–†–´ –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ï–í:
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
- –°–ø–æ—Ä–Ω—ã–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è: "–≠—Ç–æ —Å–∞–º–∞—è —á–∞—Å—Ç–∞—è –æ—à–∏–±–∫–∞. –°–æ–≥–ª–∞—Å–Ω—ã?"
- –í—ã–±–æ—Ä: "–ê —Ç—ã –∑–∞ –∏–ª–∏ –ø—Ä–æ—Ç–∏–≤? –ü–∏—à–∏ –≤ –∫–æ–º–º–µ–Ω—Ç—ã"
- –õ–∏—á–Ω—ã–π –æ–ø—ã—Ç: "–ê —É —Ç–µ–±—è —Ç–∞–∫ –±—ã–ª–æ? –†–∞—Å—Å–∫–∞–∂–∏"
- –£–≥–∞–¥–∞–π–∫–∏: "–£–≥–∞–¥–∞–π, –∫–∞–∫–æ–π –æ—Ç–≤–µ—Ç —Å–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π?"

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
üì± –°–¢–†–£–ö–¢–£–†–ê –†–ò–õ–° (15-30 —Å–µ–∫):
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
0-3 —Å–µ–∫: –®–û–ö-—Ö—É–∫ (–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–∫—Ä–æ–ª–ª)
3-20 —Å–µ–∫: –†–∞—Å–∫—Ä—ã—Ç–∏–µ + –ø–æ–ª—å–∑–∞
20-30 —Å–µ–∫: –ü—Ä–∏–∑—ã–≤ (–ø–æ–¥–ø–∏—Å–∫–∞/–∫–æ–º–º–µ–Ω—Ç/—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ)

–ü—Ä–∏–º–µ—Ä—ã —Ö—É–∫–æ–≤ –¥–ª—è —Ä–∏–ª—Å:
"–°—Ç–æ–ø! –ï—Å–ª–∏ —É–∑–Ω–∞—ë—à—å —Å–µ–±—è ‚Äî —ç—Ç–æ –¥–ª—è —Ç–µ–±—è"
"–Ø —É–∑–Ω–∞–ª–∞ —ç—Ç–æ –∏ –æ—Ñ–∏–≥–µ–ª–∞"
"–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –¥–µ–ª–∞–π —ç—Ç–æ–≥–æ, –µ—Å–ª–∏ —Ö–æ—á–µ—à—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç"
"–≠—Ç–æ—Ç –º–µ—Ç–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç —É 90% –º–æ–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–∫"

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
üö´ –ó–ê–ü–†–ï–©–ï–ù–û:
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
‚ùå "–í—Å–µ–ª–µ–Ω–Ω–∞—è –ø—Ä–∏–≥–æ—Ç–æ–≤–∏–ª–∞/–ø–æ—Å–ª–∞–ª–∞/–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç" ‚Äî –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è
‚ùå "–≠–Ω–µ—Ä–≥–∏–∏ –¥–Ω—è/–º–µ—Å—è—Ü–∞" –±–µ–∑ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è —á—Ç–æ –¥–µ–ª–∞—Ç—å
‚ùå "–û—Ç–∫—Ä–æ–π –ø–æ—Ä—Ç–∞–ª/–∫–∞–Ω–∞–ª/–ø–æ—Ç–æ–∫" ‚Äî –ø—É—Å—Ç—ã–µ —Å–ª–æ–≤–∞
‚ùå –£–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –≥–æ–¥–æ–≤ (2025, 2026) ‚Äî –∫–æ–Ω—Ç–µ–Ω—Ç —É—Å—Ç–∞—Ä–µ–µ—Ç
‚ùå –°–∫—É—á–Ω—ã–µ –Ω–∞—á–∞–ª–∞ —Ç–∏–ø–∞ "–°–µ–≥–æ–¥–Ω—è —Ö–æ—á—É —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å..."

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
‚úÖ –°–¢–ò–õ–¨:
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
- –ö–æ—Ä–æ—Ç–∫–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è. –ú–∞–∫—Å–∏–º—É–º 12 —Å–ª–æ–≤.
- –ü–∏—à–∏ –∫–∞–∫ –≥–æ–ª–æ—Å–æ–≤–æ–µ –ø–æ–¥—Ä—É–≥–µ ‚Äî –∂–∏–≤–æ, —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
- –≠–º–æ–¥–∑–∏ —É–º–µ—Å—Ç–Ω—ã, –Ω–æ –Ω–µ –±–æ–ª—å—à–µ 3-4 –Ω–∞ –ø–æ—Å—Ç
- –í–º–µ—Å—Ç–æ –≥–æ–¥–∞ –ø–∏—à–∏: "–≤ –±–ª–∏–∂–∞–π—à–∏–π –º–µ—Å—è—Ü", "—ç—Ç–æ—Ç –ø–µ—Ä–∏–æ–¥", "—Å–∫–æ—Ä–æ"
- –ö–∞–∂–¥—ã–π —Ç–µ–∫—Å—Ç = —ç–º–æ—Ü–∏—è + –ø–æ–ª—å–∑–∞ + –¥–µ–π—Å—Ç–≤–∏–µ

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
üéØ –ë–û–õ–ò –¶–ï–õ–ï–í–û–ô –ê–£–î–ò–¢–û–†–ò–ò (–±–µ–π –≤ –Ω–∏—Ö!):
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
–ö–∞–∂–¥–∞—è —Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –∫–∞—Å–∞—Ç—å—Å—è –†–ï–ê–õ–¨–ù–û–ô –ø—Ä–æ–±–ª–µ–º—ã. –ì–µ–Ω–µ—Ä–∏—Ä—É–π –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏, –∫–∞–∂–¥—ã–π —Ä–∞–∑ –ù–û–í–´–ï —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏:

üíî –û–¢–ù–û–®–ï–ù–ò–Ø (—Å–∞–º–∞—è –≥–æ—Ä—è—á–∞—è —Ç–µ–º–∞!):
- "–û–Ω –Ω–µ –ø–∏—à–µ—Ç/–Ω–µ –∑–≤–æ–Ω–∏—Ç ‚Äî —á—Ç–æ –¥–µ–ª–∞—Ç—å?"
- "–ü–æ—á–µ–º—É –≤—Å–µ –º–æ–∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è –æ–¥–∏–Ω–∞–∫–æ–≤–æ?"
- "–ö–∞–∫ –ø–æ–Ω—è—Ç—å, –∏–∑–º–µ–Ω—è–µ—Ç –ª–∏ –æ–Ω?"
- "–í–µ—Ä–Ω—ë—Ç—Å—è –ª–∏ –±—ã–≤—à–∏–π?"
- "–ü–æ—á–µ–º—É –ø—Ä–∏—Ç—è–≥–∏–≤–∞—é —Ç–æ–∫—Å–∏—á–Ω—ã—Ö/–∂–µ–Ω–∞—Ç—ã—Ö/–Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö?"
- "–ö–∞–∫ –æ—Ç–ø—É—Å—Ç–∏—Ç—å —Ç–æ–≥–æ, –∫—Ç–æ –Ω–µ –æ—Ç–ø—É—Å–∫–∞–µ—Ç?"

üí∞ –î–ï–ù–¨–ì–ò –ò –†–ê–ë–û–¢–ê:
- "–ü–æ—á–µ–º—É –¥–µ–Ω—å–≥–∏ –Ω–µ –∑–∞–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è?"
- "–ö–∞–∫ –≤—ã–π—Ç–∏ –∏–∑ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π —è–º—ã?"
- "–°—Ç—Ä–∞—Ö –±–æ–ª—å—à–∏—Ö –¥–µ–Ω–µ–≥ ‚Äî –æ—Ç–∫—É–¥–∞?"
- "–ü–æ—á–µ–º—É —è —Ä–∞–±–æ—Ç–∞—é –º–Ω–æ–≥–æ, –∞ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—é –º–∞–ª–æ?"
- "–ö–∞–∫ –Ω–∞–π—Ç–∏ —Å–≤–æ—ë –¥–µ–ª–æ/–ø—Ä–∏–∑–≤–∞–Ω–∏–µ?"
- "–ë–æ—é—Å—å –º–µ–Ω—è—Ç—å —Ä–∞–±–æ—Ç—É"

üåü –°–ê–ú–û–†–ï–ê–õ–ò–ó–ê–¶–ò–Ø:
- "–ù–µ –∑–Ω–∞—é, —á–µ–≥–æ —Ö–æ—á—É –æ—Ç –∂–∏–∑–Ω–∏"
- "–ó–∞—Å—Ç—Ä—è–ª–∞ –Ω–∞ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ"
- "–ß—É–≤—Å—Ç–≤—É—é, —á—Ç–æ –∂–∏–≤—É –Ω–µ —Å–≤–æ—é –∂–∏–∑–Ω—å"
- "–°—Ç—Ä–∞—Ö –Ω–∞—á–∞—Ç—å —á—Ç–æ-—Ç–æ –Ω–æ–≤–æ–µ"
- "–°–∏–Ω–¥—Ä–æ–º —Å–∞–º–æ–∑–≤–∞–Ω—Ü–∞"

üë®‚Äçüë©‚Äçüëß –°–ï–ú–¨–Ø –ò –î–ï–¢–ò:
- "–°–≤–µ–∫—Ä–æ–≤—å/–º–∞–º–∞ –ª–µ–∑–µ—Ç –≤ –º–æ—é –∂–∏–∑–Ω—å"
- "–ú—É–∂ –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç/–Ω–µ —Å–ª—ã—à–∏—Ç"
- "–ü—Ä–æ–±–ª–µ–º—ã —Å —Ä–µ–±—ë–Ω–∫–æ–º-–ø–æ–¥—Ä–æ—Å—Ç–∫–æ–º"
- "–ü–æ—á–µ–º—É –≤ –º–æ—ë–º —Ä–æ–¥—É –≤—Å–µ —Ä–∞–∑–≤–æ–¥—è—Ç—Å—è?"

‚ö° –≠–ù–ï–†–ì–ò–Ø –ò –ó–î–û–†–û–í–¨–ï:
- "–ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è —É—Å—Ç–∞–ª–æ—Å—Ç—å, –Ω–µ—Ç —Å–∏–ª"
- "–ß—É–≤—Å—Ç–≤—É—é —Å–µ–±—è –≤—ã–≥–æ—Ä–µ–≤—à–µ–π"
- "–ü–∞–Ω–∏—á–µ—Å–∫–∏–µ –∞—Ç–∞–∫–∏, —Ç—Ä–µ–≤–æ–≥–∞"
- "–ë–µ—Å—Å–æ–Ω–Ω–∏—Ü–∞, –ø–ª–æ—Ö–∏–µ —Å–Ω—ã"

‚ö†Ô∏è –í–ê–ñ–ù–û: 
- –ö–∞–∂–¥—ã–π —Ä–∞–∑ –≥–µ–Ω–µ—Ä–∏—Ä—É–π –ù–û–í–´–ï —Ç–µ–º—ã –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏
- –ß–µ—Ä–µ–¥—É–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –±–æ–ª–µ–π (–Ω–µ 5 –ø–æ—Å—Ç–æ–≤ –ø–æ–¥—Ä—è–¥ –ø—Ä–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—è)
- –§–æ—Ä–º—É–ª–∏—Ä—É–π —Ö—É–∫–∏ —á–µ—Ä–µ–∑ –±–æ–ª—å: "–£—Å—Ç–∞–ª–∞ –æ—Ç..." / "–ü–æ—á–µ–º—É –æ–ø—è—Ç—å..." / "–ö–∞–∫ –∏–∑–±–∞–≤–∏—Ç—å—Å—è –æ—Ç..."
- –ù–ï –ü–û–í–¢–û–†–Ø–ô –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ —Ç–µ–º—ã ‚Äî –ø—Ä–∏–¥—É–º—ã–≤–∞–π –≤–∞—Ä–∏–∞—Ü–∏–∏`;

  // Different system prompts for sale vs engagement
  const saleSystemPrompt = `–¢—ã ‚Äî SMM-–∫–æ–ø–∏—Ä–∞–π—Ç–µ—Ä –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ –≤ –Ω–∏—à–µ "${niche}". –¢–≤–æ—è —Å—É–ø–µ—Ä—Å–∏–ª–∞ ‚Äî –ø–∏—Å–∞—Ç—å —Ç–µ–∫—Å—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –ü–†–û–î–ê–Æ–¢ —á–µ—Ä–µ–∑ –≤–æ–≤–ª–µ—á–µ–Ω–∏–µ, –∞ –Ω–µ —á–µ—Ä–µ–∑ –¥–∞–≤–ª–µ–Ω–∏–µ. –°–¢–†–û–ì–û –∏—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—é –Ω–∏—à–∏ "${niche}", –ù–ï –¥–æ–±–∞–≤–ª—è–π —ç–ª–µ–º–µ–Ω—Ç—ã –∏–∑ –¥—Ä—É–≥–∏—Ö –Ω–∏—à.
${writingStyleRules}

–¢–í–û–Ø –ó–ê–î–ê–ß–ê: –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–¥–∞—é—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç-–ø–ª–∞–Ω, –≥–¥–µ –∫–∞–∂–¥—ã–π –ø–æ—Å—Ç —Å–Ω–∞—á–∞–ª–∞ –¶–ï–ü–õ–Ø–ï–¢, –ø–æ—Ç–æ–º –ø—Ä–æ–¥–∞—ë—Ç.

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
üéØ –°–¢–†–ê–¢–ï–ì–ò–Ø –ú–Ø–ì–ö–ò–• –ü–†–û–î–ê–ñ:
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
1. –í–û–í–õ–ï–ß–¨ (—Ö—É–∫, –∏–Ω—Ç—Ä–∏–≥–∞, —É–∑–Ω–∞–≤–∞–Ω–∏–µ —Å–µ–±—è)
2. –î–ê–¢–¨ –ü–û–õ–¨–ó–£ (–ø–æ–∫–∞–∑–∞—Ç—å —ç–∫—Å–ø–µ—Ä—Ç–Ω–æ—Å—Ç—å)
3. –ú–Ø–ì–ö–û –ü–†–û–î–ê–¢–¨ (—á–µ—Ä–µ–∑ –∏—Å—Ç–æ—Ä–∏—é –∏–ª–∏ –∫–µ–π—Å)

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
üí∞ –ü–†–û–î–ê–Æ–©–ò–ï –¢–ï–•–ù–ò–ö–ò:
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
- "–ë—ã–ª–æ ‚Üí –°—Ç–∞–ª–æ": –∏—Å—Ç–æ—Ä–∏—è –∫–ª–∏–µ–Ω—Ç–∫–∏ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
- FOMO: "–û—Å—Ç–∞–ª–æ—Å—å 3 –º–µ—Å—Ç–∞ –Ω–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ"
- –°–æ—Ü–∏–∞–ª—å–Ω–æ–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ: "–£–∂–µ 200+ –¥–µ–≤—É—à–µ–∫ –ø—Ä–æ—à–ª–∏"
- –°–µ–∫—Ä–µ—Ç–Ω–æ—Å—Ç—å: "–†–∞—Å—Å–∫–∞–∑—ã–≤–∞—é —Ç–æ–ª—å–∫–æ –≤ –ª–∏—á–Ω–æ–π —Ä–∞–±–æ—Ç–µ, –Ω–æ..."
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: "–ë–µ—Ä—É —Ç–æ–ª—å–∫–æ 5 –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ –º–µ—Å—è—Ü"

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
üìä –ú–ò–ö–° –ö–û–ù–¢–ï–ù–¢–ê (—Å–æ–±–ª—é–¥–∞–π!):
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
- 30% –ü—Ä—è–º—ã–µ –ø—Ä–æ–¥–∞–∂–∏: –∫–µ–π—Å—ã, –æ—Ç–∑—ã–≤—ã, "–∑–∞–ø–∏—Å—å –æ—Ç–∫—Ä—ã—Ç–∞"
- 30% –≠–∫—Å–ø–µ—Ä—Ç–Ω—ã–π: –ø–æ–ª—å–∑–∞ + –º—è–≥–∫–æ–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ —É—Å–ª—É–≥–∏
- 25% –í–æ–≤–ª–µ–∫–∞—é—â–∏–π: —Ç–µ—Å—Ç—ã, –æ–ø—Ä–æ—Å—ã (—Ä–∞–∑–æ–≥—Ä–µ–≤ –∞—É–¥–∏—Ç–æ—Ä–∏–∏)
- 15% –õ–∏—á–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏–∏: –ø—É—Ç—å, –∏–Ω—Å–∞–π—Ç—ã, –∑–∞–∫—É–ª–∏—Å—å–µ

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
‚ö° –í –ö–ê–ñ–î–û–ú –ü–û–°–¢–ï:
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
- –•—É–∫ –≤ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–µ (–∏—Å–ø–æ–ª—å–∑—É–π —Ñ–æ—Ä–º—É–ª—ã –≤—ã—à–µ!)
- –ü—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é: –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∏ –ø—Ä–æ—Å—Ç–æ–π
- –£–ø–æ–º–∏–Ω–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ ‚Äî –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ, —á–µ—Ä–µ–∑ –ø–æ–ª—å–∑—É

–î–õ–Ø –ö–ê–ñ–î–û–ì–û –î–ù–Ø —Å–æ–∑–¥–∞–π:
- idea: –∏–¥–µ—è —Å —Ö—É–∫–æ–º (—Ü–µ–ø–ª—è—é—â–∞—è —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞!)
- type: —Ç–∏–ø (–ü—Ä–æ–¥–∞—é—â–∏–π/–≠–∫—Å–ø–µ—Ä—Ç–Ω—ã–π/–õ–∏—á–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è/–í–æ–≤–ª–µ–∫–∞—é—â–∏–π)
- post: –ø–æ—Å—Ç –¥–ª—è –ª–µ–Ω—Ç—ã (—Ö—É–∫ ‚Üí –ø–æ–ª—å–∑–∞ ‚Üí –ø—Ä–∏–∑—ã–≤ –∫ –ø–æ–∫—É–ø–∫–µ)
- carousel: 5-7 —Å–ª–∞–π–¥–æ–≤. –ü–µ—Ä–≤—ã–π = –∏–Ω—Ç—Ä–∏–≥–∞. –ü–æ—Å–ª–µ–¥–Ω–∏–π = –ø—Ä–∏–∑—ã–≤. –§–æ—Ä–º–∞—Ç "–°–ª–∞–π–¥ 1: ..."
- reels: —Å—Ü–µ–Ω–∞—Ä–∏–π (—à–æ–∫-—Ö—É–∫ ‚Üí –ø–æ–ª—å–∑–∞ ‚Üí –ø—Ä–∏–∑—ã–≤ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è)
- stories: 4-5 —Å—Ç–æ—Ä–∏—Å —Å –≤–æ—Ä–æ–Ω–∫–æ–π (–∏–Ω—Ç–µ—Ä–µ—Å ‚Üí –ø–æ–ª—å–∑–∞ ‚Üí –æ—Ñ—Ñ–µ—Ä)

–§–æ—Ä–º–∞—Ç: –¢–û–õ–¨–ö–û JSON –º–∞—Å—Å–∏–≤.
–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞: {"day":1,"idea":"[–£–ù–ò–ö–ê–õ–¨–ù–ê–Ø –∏–¥–µ—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –ü–†–û–î–£–ö–¢–ê]","type":"[—Ç–∏–ø]","post":{"content":"[—Ç–µ–∫—Å—Ç]","hashtags":["#—Ç–µ–≥"]},"carousel":{"content":"–°–ª–∞–π–¥ 1: [–∑–∞–≥–æ–ª–æ–≤–æ–∫]...","hashtags":["#—Ç–µ–≥"]},"reels":{"content":"–•—É–∫: [3 —Å–µ–∫]\\n–û—Å–Ω–æ–≤–∞: [20 —Å–µ–∫]\\n–ü—Ä–∏–∑—ã–≤: [–¥–µ–π—Å—Ç–≤–∏–µ]","hashtags":["#—Ç–µ–≥"]},"stories":{"content":"–°—Ç–æ—Ä–∏—Å 1: [—Ç–µ–∫—Å—Ç]...","hashtags":["#—Ç–µ–≥"]}}

–í–ê–ñ–ù–û: –ò—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—é –Ω–∏—à–∏ "${niche}". –ù–ï –¥–æ–±–∞–≤–ª—è–π —ç–ª–µ–º–µ–Ω—Ç—ã –¥—Ä—É–≥–∏—Ö –Ω–∏—à!${archetypeInstruction}`;

  const engagementSystemPrompt = `–¢—ã ‚Äî SMM-–∫–æ–ø–∏—Ä–∞–π—Ç–µ—Ä –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ –≤ –Ω–∏—à–µ "${niche}". –¢–≤–æ—è —Å—É–ø–µ—Ä—Å–∏–ª–∞ ‚Äî —Å–æ–∑–¥–∞–≤–∞—Ç—å –í–ò–†–£–°–ù–´–ô –∫–æ–Ω—Ç–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤–∑—Ä—ã–≤–∞–µ—Ç –æ—Ö–≤–∞—Ç—ã. –°–¢–†–û–ì–û –∏—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—é –Ω–∏—à–∏ "${niche}", –ù–ï –¥–æ–±–∞–≤–ª—è–π —ç–ª–µ–º–µ–Ω—Ç—ã –∏–∑ –¥—Ä—É–≥–∏—Ö –Ω–∏—à.
${writingStyleRules}

–¢–í–û–Ø –ó–ê–î–ê–ß–ê: –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç-–ø–ª–∞–Ω, –∫–æ—Ç–æ—Ä—ã–π –í–ó–û–†–í–Å–¢ –æ—Ö–≤–∞—Ç—ã. –ö–∞–∂–¥—ã–π –ø–æ—Å—Ç = –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –≤–∏—Ä—É—Å.

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
üéØ –¶–ï–õ–ò –ö–ê–ñ–î–û–ì–û –ü–û–°–¢–ê:
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
1. –û–°–¢–ê–ù–û–í–ò–¢–¨ —Å–∫—Ä–æ–ª–ª (—à–æ–∫-—Ö—É–∫ –≤ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–µ)
2. –£–î–ï–†–ñ–ê–¢–¨ –¥–æ –∫–æ–Ω—Ü–∞ (–∏–Ω—Ç—Ä–∏–≥–∞, –æ—Ç–∫—Ä—ã—Ç–∞—è –ø–µ—Ç–ª—è)
3. –í–´–ó–í–ê–¢–¨ –¥–µ–π—Å—Ç–≤–∏–µ (–∫–æ–º–º–µ–Ω—Ç/—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/—Ä–µ–ø–æ—Å—Ç)

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
üìä –ú–ò–ö–° –ö–û–ù–¢–ï–ù–¢–ê (—Å–æ–±–ª—é–¥–∞–π –±–∞–ª–∞–Ω—Å!):
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
- 40% –í–æ–≤–ª–µ–∫–∞—é—â–∏–π: —Ç–µ—Å—Ç—ã, –æ–ø—Ä–æ—Å—ã, —É–≥–∞–¥–∞–π–∫–∏, –≤–æ–ø—Ä–æ—Å—ã –≤ –∫–æ–º–º–µ–Ω—Ç—ã
- 30% –≠–∫—Å–ø–µ—Ä—Ç–Ω—ã–π: –ª–∞–π—Ñ—Ö–∞–∫–∏, —á–µ–∫–ª–∏—Å—Ç—ã, "—Å–æ—Ö—Ä–∞–Ω–∏ —Å–µ–±–µ"
- 20% –õ–∏—á–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏–∏: —Å –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–º –ø–æ–≤–æ—Ä–æ—Ç–æ–º
- 10% –†–∞–∑–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–π: –º–µ–º—ã –ø—Ä–æ –∂–∏–∑–Ω–µ–Ω–Ω—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏, —Å–º–µ—à–Ω—ã–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
‚ö° –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –í –ö–ê–ñ–î–û–ú –ü–û–°–¢–ï:
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
- –•—É–∫ –≤ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–µ (—Å–º. —Ñ–æ—Ä–º—É–ª—ã –≤—ã—à–µ)
- –ü—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é –≤ –∫–æ–Ω—Ü–µ
- –î–ª—è –∫–∞—Ä—É—Å–µ–ª–∏: –∏–Ω—Ç—Ä–∏–≥–∞ –Ω–∞ –ø–µ—Ä–≤–æ–º —Å–ª–∞–π–¥–µ ("–õ–∏—Å—Ç–∞–π –¥–æ –∫–æ–Ω—Ü–∞!")
- –î–ª—è —Ä–∏–ª—Å: —à–æ–∫ –≤ –ø–µ—Ä–≤—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã

–î–õ–Ø –ö–ê–ñ–î–û–ì–û –î–ù–Ø —Å–æ–∑–¥–∞–π:
- idea: –∏–¥–µ—è —Å —Ö—É–∫–æ–º (–Ω–µ –ø—Ä–æ—Å—Ç–æ —Ç–µ–º–∞, –∞ —Ü–µ–ø–ª—è—é—â–∞—è —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞!)
- type: —Ç–∏–ø (–í–æ–≤–ª–µ–∫–∞—é—â–∏–π/–≠–∫—Å–ø–µ—Ä—Ç–Ω—ã–π/–õ–∏—á–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è/–†–∞–∑–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–π)
- post: –ø–æ—Å—Ç –¥–ª—è –ª–µ–Ω—Ç—ã (—Ö—É–∫ ‚Üí —Ä–∞—Å–∫—Ä—ã—Ç–∏–µ ‚Üí –ø—Ä–∏–∑—ã–≤)
- carousel: –∫–∞—Ä—É—Å–µ–ª—å 5-7 —Å–ª–∞–π–¥–æ–≤. –ü–ï–†–í–´–ô —Å–ª–∞–π–¥ = –∏–Ω—Ç—Ä–∏–≥–∞. –§–æ—Ä–º–∞—Ç "–°–ª–∞–π–¥ 1: –ó–∞–≥–æ–ª–æ–≤–æ–∫\\n–¢–µ–∫—Å—Ç..."
- reels: —Å—Ü–µ–Ω–∞—Ä–∏–π (0-3 —Å–µ–∫: —à–æ–∫-—Ö—É–∫ ‚Üí 3-20 —Å–µ–∫: –ø–æ–ª—å–∑–∞ ‚Üí –ø—Ä–∏–∑—ã–≤)
- stories: —Å–µ—Ä–∏—è 4-5 —Å—Ç–æ—Ä–∏—Å —Å –æ–ø—Ä–æ—Å–∞–º–∏/–≤—ã–±–æ—Ä–æ–º. –§–æ—Ä–º–∞—Ç "–°—Ç–æ—Ä–∏—Å 1: ..."

–§–æ—Ä–º–∞—Ç: –¢–û–õ–¨–ö–û JSON –º–∞—Å—Å–∏–≤.
–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞: {"day":1,"idea":"[–£–ù–ò–ö–ê–õ–¨–ù–ê–Ø –∏–¥–µ—è ‚Äî –ø—Ä–∏–¥—É–º–∞–π –ù–û–í–£–Æ –∫–∞–∂–¥—ã–π —Ä–∞–∑]","type":"[—Ç–∏–ø]","post":{"content":"[—Ç–µ–∫—Å—Ç]","hashtags":["#—Ç–µ–≥"]},"carousel":{"content":"–°–ª–∞–π–¥ 1: [–∑–∞–≥–æ–ª–æ–≤–æ–∫]...","hashtags":["#—Ç–µ–≥"]},"reels":{"content":"–•—É–∫: [3 —Å–µ–∫]\\n–û—Å–Ω–æ–≤–∞: [20 —Å–µ–∫]\\n–ü—Ä–∏–∑—ã–≤: [–¥–µ–π—Å—Ç–≤–∏–µ]","hashtags":["#—Ç–µ–≥"]},"stories":{"content":"–°—Ç–æ—Ä–∏—Å 1: [—Ç–µ–∫—Å—Ç]...","hashtags":["#—Ç–µ–≥"]}}

–í–ê–ñ–ù–û: –ò—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—é –Ω–∏—à–∏ "${niche}". –ù–ï –¥–æ–±–∞–≤–ª—è–π —ç–ª–µ–º–µ–Ω—Ç—ã –¥—Ä—É–≥–∏—Ö –Ω–∏—à!${archetypeInstruction}`;

  const systemPrompt = goal === "sale" ? saleSystemPrompt : engagementSystemPrompt;

  const userPrompt = goal === "sale" 
    ? `–°–æ–∑–¥–∞–π –ü–†–û–î–ê–Æ–©–ò–ô –∫–æ–Ω—Ç–µ–Ω—Ç-–ø–ª–∞–Ω –Ω–∞ ${days} ${getDaysWord(days)} –¥–ª—è:

–ù–ò–®–ê: ${niche}

–ü–†–û–î–£–ö–¢ –î–õ–Ø –ü–†–û–î–ê–ñ–ò: "${product || '–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è'}"

–°–¢–†–ê–¢–ï–ì–ò–Ø: ${strategyDescription}

–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø:
1. –°–æ–∑–¥–∞–π —Ä–æ–≤–Ω–æ ${days} –¥–Ω–µ–π –∫–æ–Ω—Ç–µ–Ω—Ç–∞
2. –ù–∞ –ö–ê–ñ–î–´–ô –¥–µ–Ω—å —Å–æ–∑–¥–∞–π:
   - idea: –∫—Ä–∞—Ç–∫–∞—è –∏–¥–µ—è –¥–Ω—è
   - type: —Ç–∏–ø (–≠–∫—Å–ø–µ—Ä—Ç–Ω—ã–π/–õ–∏—á–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è/–ü—Ä–æ–¥–∞—é—â–∏–π/–í–æ–≤–ª–µ–∫–∞—é—â–∏–π)
   - post: –≥–æ—Ç–æ–≤—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è –ª–µ–Ω—Ç—ã (2-3 –∞–±–∑–∞—Ü–∞ + –ø—Ä–∏–∑—ã–≤)
   - carousel: —Ç–µ–∫—Å—Ç –¥–ª—è –∫–∞—Ä—É—Å–µ–ª–∏ (5-7 —Å–ª–∞–π–¥–æ–≤, —Ñ–æ—Ä–º–∞—Ç "–°–ª–∞–π–¥ 1: ...")
   - reels: —Å—Ü–µ–Ω–∞—Ä–∏–π —Ä–∏–ª—Å (—Ö—É–∫ ‚Üí –æ—Å–Ω–æ–≤–∞ ‚Üí –ø—Ä–∏–∑—ã–≤)
   - stories: —Å–µ—Ä–∏—è —Å—Ç–æ—Ä–∏—Å (4-5 —Å–ª–∞–π–¥–æ–≤, —Ñ–æ—Ä–º–∞—Ç "–°—Ç–æ—Ä–∏—Å 1: ...")
3. –ö–∞–∂–¥—ã–π —Ñ–æ—Ä–º–∞—Ç —Å hashtags –º–∞—Å—Å–∏–≤–æ–º

–û—Ç–≤–µ—Ç—å –¢–û–õ–¨–ö–û JSON –º–∞—Å—Å–∏–≤–æ–º.`
    : `–°–æ–∑–¥–∞–π –∫–æ–Ω—Ç–µ–Ω—Ç-–ø–ª–∞–Ω –Ω–∞ ${days} ${getDaysWord(days)} –¥–ª—è –í–û–í–õ–ï–ß–ï–ù–ò–Ø:

–ù–ò–®–ê: ${niche}

–¶–ï–õ–¨: –£–≤–µ–ª–∏—á–∏—Ç—å –æ—Ö–≤–∞—Ç—ã, –ª–∞–π–∫–∏, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø:
1. –°–æ–∑–¥–∞–π —Ä–æ–≤–Ω–æ ${days} –¥–Ω–µ–π –∫–æ–Ω—Ç–µ–Ω—Ç–∞
2. –ù–∞ –ö–ê–ñ–î–´–ô –¥–µ–Ω—å —Å–æ–∑–¥–∞–π:
   - idea: –∫—Ä–∞—Ç–∫–∞—è –∏–¥–µ—è –¥–Ω—è
   - type: —Ç–∏–ø (–≠–∫—Å–ø–µ—Ä—Ç–Ω—ã–π/–õ–∏—á–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è/–í–æ–≤–ª–µ–∫–∞—é—â–∏–π/–†–∞–∑–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–π)
   - post: –≥–æ—Ç–æ–≤—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è –ª–µ–Ω—Ç—ã (2-3 –∞–±–∑–∞—Ü–∞ + –ø—Ä–∏–∑—ã–≤)
   - carousel: —Ç–µ–∫—Å—Ç –¥–ª—è –∫–∞—Ä—É—Å–µ–ª–∏ (5-7 —Å–ª–∞–π–¥–æ–≤, —Ñ–æ—Ä–º–∞—Ç "–°–ª–∞–π–¥ 1: ...")
   - reels: —Å—Ü–µ–Ω–∞—Ä–∏–π —Ä–∏–ª—Å (—Ö—É–∫ ‚Üí –æ—Å–Ω–æ–≤–∞ ‚Üí –ø—Ä–∏–∑—ã–≤)
   - stories: —Å–µ—Ä–∏—è —Å—Ç–æ—Ä–∏—Å (4-5 —Å–ª–∞–π–¥–æ–≤, —Ñ–æ—Ä–º–∞—Ç "–°—Ç–æ—Ä–∏—Å 1: ...")
3. –ö–∞–∂–¥—ã–π —Ñ–æ—Ä–º–∞—Ç —Å hashtags –º–∞—Å—Å–∏–≤–æ–º

–û—Ç–≤–µ—Ç—å –¢–û–õ–¨–ö–û JSON –º–∞—Å—Å–∏–≤–æ–º.`;

  try {
    console.log("Calling DeepSeek API...");
    const startTime = Date.now();
    
    const response = await getClient().chat.completions.create({
      model: "deepseek-chat",
      messages: [
        { role: "system", content: systemPrompt },
        { role: "user", content: userPrompt },
      ],
      temperature: 0.7,
      max_tokens: 8000,
    });

    const elapsed = Date.now() - startTime;
    console.log(`DeepSeek API responded in ${elapsed}ms`);

    const content = response.choices[0]?.message?.content || "[]";
    console.log("Raw AI response length:", content.length);
    
    if (content.length < 100) {
      console.error("Response too short, content:", content);
      throw new Error("AI returned empty or too short response");
    }
    
    return parseContentResponse(content);
  } catch (error: any) {
    console.error("Content generation error:", error?.message || error);
    console.error("Error details:", JSON.stringify(error, null, 2));
    throw error;
  }
}

function getDaysWord(days: number): string {
  if (days === 1) return "–¥–µ–Ω—å";
  if (days >= 2 && days <= 4) return "–¥–Ω—è";
  return "–¥–Ω–µ–π";
}

// New interfaces for two-step generation
export interface ContentIdea {
  day: number;
  idea: string;
  type: string;
}

export interface SingleFormatInput {
  goal: "sale" | "engagement";
  niche: string;
  product?: string;
  idea: string;
  type: string;
  format: "post" | "carousel" | "reels" | "stories";
  gender?: "female" | "male";
  archetype?: {
    name: string;
    description: string;
    recommendations: string[];
    triggerWords?: string[];
    contentStyle?: string[];
    tone?: string;
  };
}

// Step 1: Generate only ideas (fast, ~10-20 seconds)
export async function generateIdeasOnly(input: ContentGenerationInput): Promise<ContentIdea[]> {
  const { goal, niche, days, product, strategy, archetype } = input;
  
  const archetypeInstruction = archetype 
    ? `\n\n–ê—Ä—Ö–µ—Ç–∏–ø –±—Ä–µ–Ω–¥–∞: ${archetype.name}. ${archetype.description}`
    : "";

  // Random seed for variety - each generation is unique
  const randomSeed = Math.floor(Math.random() * 1000000);
  const randomCategories = [
    "–æ—Ç–Ω–æ—à–µ–Ω–∏—è –∏ –ª—é–±–æ–≤—å",
    "–¥–µ–Ω—å–≥–∏ –∏ –∫–∞—Ä—å–µ—Ä–∞", 
    "—Å–∞–º–æ—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ",
    "–∑–¥–æ—Ä–æ–≤—å–µ –∏ —ç–Ω–µ—Ä–≥–∏—è",
    "—Å–µ–º—å—è –∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è —Å –±–ª–∏–∑–∫–∏–º–∏"
  ];
  // Pick 2-3 random categories for this generation
  const shuffled = randomCategories.sort(() => Math.random() - 0.5);
  const selectedCategories = shuffled.slice(0, 2 + Math.floor(Math.random() * 2)).join(", ");

  const systemPrompt = `–¢—ã ‚Äî –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–π SMM-—Å—Ç—Ä–∞—Ç–µ–≥. –¢—ã –ø–∏—à–µ—à—å –∫–æ–Ω—Ç–µ–Ω—Ç –û–¢ –õ–ò–¶–ê —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞ –≤ –Ω–∏—à–µ "${niche}" –î–õ–Ø –ï–ì–û –ö–õ–ò–ï–ù–¢–û–ö.

üé≤ SEED –ì–ï–ù–ï–†–ê–¶–ò–ò: ${randomSeed}
üìå –§–û–ö–£–° –ù–ê –ö–ê–¢–ï–ì–û–†–ò–ò: ${selectedCategories}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
üë© –¶–ï–õ–ï–í–ê–Ø –ê–£–î–ò–¢–û–†–ò–Ø ‚Äî –ö–õ–ò–ï–ù–¢–ö–ò –°–ü–ï–¶–ò–ê–õ–ò–°–¢–ê:
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
- –ñ–µ–Ω—â–∏–Ω—ã 25-45 –ª–µ—Ç —Å –û–ë–´–ß–ù–´–ú–ò –∂–∏–∑–Ω–µ–Ω–Ω—ã–º–∏ –ø—Ä–æ–±–ª–µ–º–∞–º–∏
- –ù–ï –∫–æ–ª–ª–µ–≥–∏-–ø—Ä–∞–∫—Ç–∏–∫–∏ –∏–∑ —Ç–æ–π –∂–µ –Ω–∏—à–∏
- –≠—Ç–æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ö–õ–ò–ï–ù–¢–´, –∫–æ—Ç–æ—Ä—ã–º –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞

‚õî –ó–ê–ü–†–ï–©–ï–ù–û (—ç—Ç–æ B2B-—Ç–µ–º—ã –¥–ª—è –∫–æ–ª–ª–µ–≥!):
- –¢–µ–º—ã –ø—Ä–æ –æ–±—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏
- "–û—à–∏–±–∫–∏ –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤"
- "–ö–∞–∫ —Å—Ç–∞—Ç—å —ç–∫—Å–ø–µ—Ä—Ç–æ–º –≤ –Ω–∏—à–µ"
- –¢–µ—Ö–Ω–∏–∫–∏ –∏ –º–µ—Ç–æ–¥–∏–∫–∏ –¥–ª—è –∫–æ–ª–ª–µ–≥
- –õ—é–±—ã–µ —Ç–µ–º—ã –ü–†–û –ü–†–û–§–ï–°–°–ò–Æ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞

‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û (—ç—Ç–æ B2C –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–∫!):
- –ü—Ä–æ–±–ª–µ–º—ã –≤ –û–¢–ù–û–®–ï–ù–ò–Ø–• –∫–ª–∏–µ–Ω—Ç–∫–∏
- –ü—Ä–æ–±–ª–µ–º—ã —Å –î–ï–ù–¨–ì–ê–ú–ò –∫–ª–∏–µ–Ω—Ç–∫–∏
- –ü—Ä–æ–±–ª–µ–º—ã —Å –°–ê–ú–û–†–ï–ê–õ–ò–ó–ê–¶–ò–ï–ô –∫–ª–∏–µ–Ω—Ç–∫–∏
- –ò—Å—Ç–æ—Ä–∏–∏ –ö–õ–ò–ï–ù–¢–û–ö —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º

üéØ –ë–û–õ–ò –ö–õ–ò–ï–ù–¢–û–ö (–≤—ã–±–∏—Ä–∞–π —Ä–∞–∑–Ω—ã–µ!):

üíî –û–¢–ù–û–®–ï–ù–ò–Ø (–≥–ª–∞–≤–Ω–∞—è –±–æ–ª—å!):
- –æ–Ω –Ω–µ –ø–∏—à–µ—Ç/–ø—Ä–æ–ø–∞–ª/–∏–≥–Ω–æ—Ä–∏—Ç
- —Ç–æ–∫—Å–∏—á–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è, –∞–±—å—é–∑
- "–ø–æ—á–µ–º—É —è –ø—Ä–∏—Ç—è–≥–∏–≤–∞—é –Ω–µ —Ç–µ—Ö –º—É–∂—á–∏–Ω"
- –≤–µ—Ä–Ω—ë—Ç—Å—è –ª–∏ –æ–Ω? –∏–∑–º–µ–Ω—è–µ—Ç –ª–∏?
- —Ä–∞–∑–≤–æ–¥, —Ä–∞—Å—Å—Ç–∞–≤–∞–Ω–∏–µ, –∫–∞–∫ –æ—Ç–ø—É—Å—Ç–∏—Ç—å
- –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–æ, —Å—Ç—Ä–∞—Ö –Ω–µ –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å

üí∞ –î–ï–ù–¨–ì–ò:
- –ø–æ—á–µ–º—É –¥–µ–Ω—å–≥–∏ –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç
- –¥–æ–ª–≥–∏, —Ñ–∏–Ω–∞–Ω—Å–æ–≤–∞—è —è–º–∞
- –Ω–µ –º–æ–≥—É –Ω–∞–π—Ç–∏ —Ä–∞–±–æ—Ç—É –ø–æ –¥—É—à–µ
- —Å—Ç—Ä–∞—Ö –±–æ–ª—å—à–∏—Ö –¥–µ–Ω–µ–≥
- –∑–∞—Å—Ç–æ–π –≤ –∫–∞—Ä—å–µ—Ä–µ

üåü –°–ê–ú–û–†–ï–ê–õ–ò–ó–ê–¶–ò–Ø:
- –Ω–µ –∑–Ω–∞—é —á–µ–≥–æ —Ö–æ—á—É –æ—Ç –∂–∏–∑–Ω–∏
- —á—É–≤—Å—Ç–≤–æ —á—Ç–æ –∂–∏–≤—É –Ω–µ —Å–≤–æ—é –∂–∏–∑–Ω—å
- —Å—Ç—Ä–∞—Ö –Ω–∞—á–∞—Ç—å –Ω–æ–≤–æ–µ
- –ø–æ—Ç–µ—Ä—è–ª–∞ —Å–µ–±—è –≤ –¥–µ–∫—Ä–µ—Ç–µ/–æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö

üë®‚Äçüë©‚Äçüëß –°–ï–ú–¨–Ø:
- –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Å –º–∞–º–æ–π/—Å–≤–µ–∫—Ä–æ–≤—å—é
- –º—É–∂ –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç/–Ω–µ —Å–ª—ã—à–∏—Ç
- –ø—Ä–æ–±–ª–µ–º—ã —Å –¥–µ—Ç—å–º–∏-–ø–æ–¥—Ä–æ—Å—Ç–∫–∞–º–∏

‚ö° –≠–ù–ï–†–ì–ò–Ø –ò –ó–î–û–†–û–í–¨–ï:
- –ø–æ—Å—Ç–æ—è–Ω–Ω–∞—è —É—Å—Ç–∞–ª–æ—Å—Ç—å, –Ω–µ—Ç —Å–∏–ª
- —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å, –ø–∞–Ω–∏—á–µ—Å–∫–∏–µ –∞—Ç–∞–∫–∏
- –ø–ª–æ—Ö–∏–µ —Å–Ω—ã, –±–µ—Å—Å–æ–Ω–Ω–∏—Ü–∞

–ü–†–ê–í–ò–õ–ê:
- –ü–∏—à–∏ –ø—Ä–æ –ö–õ–ò–ï–ù–¢–ö–£ –∏ –µ—ë –±–æ–ª—å, –Ω–µ –ø—Ä–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏—é —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞
- –ë–µ–π –≤ –ö–û–ù–ö–†–ï–¢–ù–£–Æ –ø—Ä–æ–±–ª–µ–º—É –∂–∏–∑–Ω–∏
- –§–æ—Ä–º—É–ª–∏—Ä—É–π —Ç–∞–∫, —á—Ç–æ–±—ã –∫–ª–∏–µ–Ω—Ç–∫–∞ —É–∑–Ω–∞–ª–∞ –°–ï–ë–Ø
- –ò—Å–ø–æ–ª—å–∑—É–π –ª—é–±–æ–ø—ã—Ç—Å—Ç–≤–æ: "–ü–æ—á–µ–º—É –æ–Ω..." / "–ß—Ç–æ –º–µ—à–∞–µ—Ç —Ç–µ–±–µ..."
- –°–¢–†–û–ì–û –∏—Å–ø–æ–ª—å–∑—É–π —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—é –∏ –º–µ—Ç–æ–¥—ã –∏–∑ –Ω–∏—à–∏ "${niche}", –ù–ï –¥–æ–±–∞–≤–ª—è–π —ç–ª–µ–º–µ–Ω—Ç—ã –∏–∑ –¥—Ä—É–≥–∏—Ö –Ω–∏—à${archetypeInstruction}`;

  const userPrompt = goal === "sale"
    ? `SEED: ${randomSeed}
–ü—Ä–∏–¥—É–º–∞–π ${days} –£–ù–ò–ö–ê–õ–¨–ù–´–• –∏–¥–µ–π –¥–ª—è –ü–†–û–î–ê–Æ–©–ï–ì–û –∫–æ–Ω—Ç–µ–Ω—Ç–∞.
–ö–æ–Ω—Ç–µ–Ω—Ç –û–¢ –õ–ò–¶–ê —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞ –≤ –Ω–∏—à–µ "${niche}" –î–õ–Ø –µ–≥–æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –ö–õ–ò–ï–ù–¢–û–ö.
–ù–ò–®–ê: ${niche}
–ü–†–û–î–£–ö–¢: "${product || '–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è'}"
–§–û–ö–£–°: ${selectedCategories}

üéØ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ò–°–ü–û–õ–¨–ó–£–ô –û–ü–ò–°–ê–ù–ò–ï –ü–†–û–î–£–ö–¢–ê –í –ö–ê–ñ–î–û–ô –ò–î–ï–ï:
"${product || '–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è'}"

–ö–∞–∂–¥–∞—è –∏–¥–µ—è –¥–æ–ª–∂–Ω–∞:
- –ë–∏—Ç—å –≤ –ö–û–ù–ö–†–ï–¢–ù–£–Æ –±–æ–ª—å –∫–ª–∏–µ–Ω—Ç–∫–∏
- –°–≤—è–∑—ã–≤–∞—Ç—å –±–æ–ª—å —Å –ü–†–û–î–£–ö–¢–û–ú —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞
- –ë—ã—Ç—å –£–ù–ò–ö–ê–õ–¨–ù–û–ô ‚Äî –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–π –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏

‚õî –ù–ï –ø–∏—à–∏ –ø—Ä–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏—é —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞, —Ç–µ—Ö–Ω–∏–∫–∏ –¥–ª—è –∫–æ–ª–ª–µ–≥!
‚úÖ –ü–∏—à–∏ –ø—Ä–æ –ñ–ò–ó–ù–ï–ù–ù–´–ï –ë–û–õ–ò –∫–ª–∏–µ–Ω—Ç–æ–∫ –∏ –∫–∞–∫ –ü–†–û–î–£–ö–¢ –∏—Ö —Ä–µ—à–∞–µ—Ç!
‚ö†Ô∏è –°–¢–†–û–ì–û –∏—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—é –Ω–∏—à–∏ "${niche}", –ù–ï –¥–æ–±–∞–≤–ª—è–π —ç–ª–µ–º–µ–Ω—Ç—ã –∏–∑ –¥—Ä—É–≥–∏—Ö –Ω–∏—à (—Ç–∞—Ä–æ, –∞—Å—Ç—Ä–æ–ª–æ–≥–∏—è –∏ —Ç.–¥. –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ —É–∫–∞–∑–∞–Ω–æ –≤ –Ω–∏—à–µ)!

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è:
- day: –Ω–æ–º–µ—Ä
- idea: —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ –ë–û–õ–¨ –ö–õ–ò–ï–ù–¢–ö–ò (1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)
- type: —Ç–∏–ø (–≠–∫—Å–ø–µ—Ä—Ç–Ω—ã–π/–õ–∏—á–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è/–ü—Ä–æ–¥–∞—é—â–∏–π/–í–æ–≤–ª–µ–∫–∞—é—â–∏–π)

–û—Ç–≤–µ—Ç—å –¢–û–õ–¨–ö–û –≤–∞–ª–∏–¥–Ω—ã–º JSON –æ–±—ä–µ–∫—Ç–æ–º –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
{"ideas": [{"day":1,"idea":"—Ç–µ–∫—Å—Ç –∏–¥–µ–∏","type":"—Ç–∏–ø"}]}`
    : `SEED: ${randomSeed}
–ü—Ä–∏–¥—É–º–∞–π ${days} –£–ù–ò–ö–ê–õ–¨–ù–´–• –∏–¥–µ–π –¥–ª—è –í–û–í–õ–ï–ö–ê–Æ–©–ï–ì–û –∫–æ–Ω—Ç–µ–Ω—Ç–∞.
–ö–æ–Ω—Ç–µ–Ω—Ç –û–¢ –õ–ò–¶–ê —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞ –≤ –Ω–∏—à–µ "${niche}" –î–õ–Ø –µ–≥–æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –ö–õ–ò–ï–ù–¢–û–ö.
–ù–ò–®–ê: ${niche}
–§–û–ö–£–°: ${selectedCategories}

–ö–∞–∂–¥–∞—è –∏–¥–µ—è –¥–æ–ª–∂–Ω–∞:
- –ë–∏—Ç—å –≤ –ö–û–ù–ö–†–ï–¢–ù–£–Æ –±–æ–ª—å –∫–ª–∏–µ–Ω—Ç–∫–∏
- –ë—ã—Ç—å –í–û–í–õ–ï–ö–ê–Æ–©–ï–ô ‚Äî –≤—ã–∑—ã–≤–∞—Ç—å –∂–µ–ª–∞–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å/—Å–æ—Ö—Ä–∞–Ω—è—Ç—å
- –ë—ã—Ç—å –£–ù–ò–ö–ê–õ–¨–ù–û–ô ‚Äî –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–π –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏

‚õî –ù–ï –ø–∏—à–∏ –ø—Ä–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏—é —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞, —Ç–µ—Ö–Ω–∏–∫–∏ –¥–ª—è –∫–æ–ª–ª–µ–≥!
‚úÖ –ü–∏—à–∏ –ø—Ä–æ –ñ–ò–ó–ù–ï–ù–ù–´–ï –ë–û–õ–ò –∫–ª–∏–µ–Ω—Ç–æ–∫!
‚ö†Ô∏è –°–¢–†–û–ì–û –∏—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—é –Ω–∏—à–∏ "${niche}", –ù–ï –¥–æ–±–∞–≤–ª—è–π —ç–ª–µ–º–µ–Ω—Ç—ã –∏–∑ –¥—Ä—É–≥–∏—Ö –Ω–∏—à (—Ç–∞—Ä–æ, –∞—Å—Ç—Ä–æ–ª–æ–≥–∏—è –∏ —Ç.–¥. –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ —É–∫–∞–∑–∞–Ω–æ –≤ –Ω–∏—à–µ)!

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è:
- day: –Ω–æ–º–µ—Ä
- idea: —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ –ë–û–õ–¨ –ö–õ–ò–ï–ù–¢–ö–ò (1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)
- type: —Ç–∏–ø (–≠–∫—Å–ø–µ—Ä—Ç–Ω—ã–π/–õ–∏—á–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è/–í–æ–≤–ª–µ–∫–∞—é—â–∏–π/–†–∞–∑–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–π)

–û—Ç–≤–µ—Ç—å –¢–û–õ–¨–ö–û –≤–∞–ª–∏–¥–Ω—ã–º JSON –æ–±—ä–µ–∫—Ç–æ–º –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
{"ideas": [{"day":1,"idea":"—Ç–µ–∫—Å—Ç –∏–¥–µ–∏","type":"—Ç–∏–ø"}]}`;

  const maxRetries = 2;
  let lastError: any = null;
  
  for (let attempt = 1; attempt <= maxRetries; attempt++) {
    try {
      console.log(`Generating ideas only (attempt ${attempt}/${maxRetries})...`);
      const startTime = Date.now();
      
      const response = await getClient().chat.completions.create({
        model: "deepseek-chat",
        messages: [
          { role: "system", content: systemPrompt },
          { role: "user", content: userPrompt },
        ],
        temperature: 0.95,
        max_tokens: 8000,
        response_format: { type: "json_object" },
      });

      const elapsed = Date.now() - startTime;
      console.log(`Ideas generated in ${elapsed}ms`);

      const content = response.choices[0]?.message?.content || "{}";
      console.log("Raw AI response (first 500 chars):", content.substring(0, 500));
      
      try {
        const parsed = JSON.parse(content);
        
        // Handle both formats: { ideas: [...] } or direct array [...]
        if (parsed.ideas && Array.isArray(parsed.ideas)) {
          return parsed.ideas as ContentIdea[];
        } else if (Array.isArray(parsed)) {
          return parsed as ContentIdea[];
        } else {
          // Try to find array in response
          const cleaned = cleanJsonResponse(content);
          const jsonMatch = cleaned.match(/\[[\s\S]*\]/);
          if (jsonMatch) {
            return JSON.parse(jsonMatch[0]) as ContentIdea[];
          }
          throw new Error("No ideas array found in response");
        }
      } catch (parseError: any) {
        console.error("JSON parse error:", parseError.message);
        console.error("Response content:", content.substring(0, 300));
        throw new Error(`JSON parse failed: ${parseError.message}`);
      }
    } catch (error: any) {
      lastError = error;
      console.error(`Ideas generation error (attempt ${attempt}):`, error?.message || error);
      
      if (attempt < maxRetries) {
        console.log("Retrying in 1 second...");
        await new Promise(resolve => setTimeout(resolve, 1000));
      }
    }
  }
  
  console.error("All retry attempts failed");
  throw lastError;
}

// Step 2: Generate single format content (on demand)
export async function generateSingleFormat(input: SingleFormatInput): Promise<FormatContent> {
  const { goal, niche, product, idea, type, format, gender, archetype } = input;
  
  const genderInstruction = gender === "male" 
    ? "\n\n–í–ê–ñ–ù–û: –ü–∏—à–∏ –æ—Ç –ú–£–ñ–°–ö–û–ì–û —Ä–æ–¥–∞. –ê–≤—Ç–æ—Ä ‚Äî –º—É–∂—á–∏–Ω–∞. –ò—Å–ø–æ–ª—å–∑—É–π –º—É–∂—Å–∫–∏–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è: —è —Å–¥–µ–ª–∞–ª, —è –ø–æ–Ω—è–ª, —è —Ä–∞—Å—Å–∫–∞–∑–∞–ª."
    : "\n\n–í–ê–ñ–ù–û: –ü–∏—à–∏ –æ—Ç –ñ–ï–ù–°–ö–û–ì–û —Ä–æ–¥–∞. –ê–≤—Ç–æ—Ä ‚Äî –∂–µ–Ω—â–∏–Ω–∞. –ò—Å–ø–æ–ª—å–∑—É–π –∂–µ–Ω—Å–∫–∏–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è: —è —Å–¥–µ–ª–∞–ª–∞, —è –ø–æ–Ω—è–ª–∞, —è —Ä–∞—Å—Å–∫–∞–∑–∞–ª–∞.";
  
  const archetypeInstruction = archetype 
    ? `\n\n–ê–†–•–ï–¢–ò–ü –ë–†–ï–ù–î–ê: "${archetype.name}"
${archetype.description}
${archetype.tone ? `–¢–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å: ${archetype.tone}` : ''}
${archetype.triggerWords?.length ? `–°–ª–æ–≤–∞-—Ç—Ä–∏–≥–≥–µ—Ä—ã (–∏—Å–ø–æ–ª—å–∑—É–π –≤ —Ç–µ–∫—Å—Ç–µ): ${archetype.triggerWords.slice(0, 8).join(", ")}` : ''}
${archetype.contentStyle?.length ? `–°—Ç–∏–ª—å: ${archetype.contentStyle.slice(0, 3).join("; ")}` : ''}
–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞: ${archetype.recommendations.join(", ")}

–ü–∏—à–∏ –≤ —Å—Ç–∏–ª–µ —ç—Ç–æ–≥–æ –∞—Ä—Ö–µ—Ç–∏–ø–∞!`
    : "";

  const writingRules = `
–ì–õ–ê–í–ù–û–ï: –ö–ª–∏–µ–Ω—Ç —á–∏—Ç–∞–µ—Ç –ø–µ—Ä–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ ‚Äî –∏ –°–†–ê–ó–£ –ø–æ–Ω–∏–º–∞–µ—Ç, –æ —á—ë–º —Ä–µ—á—å.

–ß–ï–ö–õ–ò–°–¢:
‚úì –ù–∞—á–Ω–∏ —Å –ö–û–ù–ö–†–ï–¢–ù–û–ô –±–æ–ª–∏ –∫–ª–∏–µ–Ω—Ç–∫–∏
‚úì –î–∞–π –ö–û–ù–ö–†–ï–¢–ù–´–ô —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å —Ü–∏—Ñ—Ä–æ–π ("–ó–∞ 60 –º–∏–Ω—É—Ç —Ä–∞–∑–±–µ—Ä—ë–º —Å–∏—Ç—É–∞—Ü–∏—é")
‚úì –¢–µ—Ä–º–∏–Ω? –û–±—ä—è—Å–Ω–∏ —Ç—É—Ç –∂–µ –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏
‚úì –ü—Ä–∏–∑—ã–≤ ‚Äî —á—Ç–æ –ò–ú–ï–ù–ù–û —Å–¥–µ–ª–∞—Ç—å

–ó–ê–ü–†–ï–©–ï–ù–û:
‚ùå –ê–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –±–µ–∑ –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫–∏ —á—Ç–æ –¥–µ–ª–∞—Ç—å
‚ùå –ü—É—Å—Ç—ã–µ –æ–±–µ—â–∞–Ω–∏—è
‚ùå –≠–ª–µ–º–µ–Ω—Ç—ã –∏–∑ –î–†–£–ì–ò–• –Ω–∏—à (–µ—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç ‚Äî –ø—Å–∏—Ö–æ–ª–æ–≥, –ù–ï –ø–∏—à–∏ –ø—Ä–æ —Ç–∞—Ä–æ/–∫–∞—Ä—Ç—ã/–∞—Å—Ç—Ä–æ–ª–æ–≥–∏—é!)

–°–¢–ò–õ–¨: –ö–æ—Ä–æ—Ç–∫–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è. –ú–∞–∫—Å–∏–º—É–º 15 —Å–ª–æ–≤. –ö–∞–∫ –ø–æ–¥—Ä—É–≥–µ –∑–∞ —á–∞–µ–º.`;

  const selectedReelsHooks = getRandomElements(REELS_HOOK_FORMULAS, 6);
  const selectedStoriesHooks = getRandomElements(STORIES_HOOK_FORMULAS, 6);
  const selectedReelsStyle = getRandomElements(CONTENT_STYLES, 1)[0];
  const selectedStoriesStyle = getRandomElements(CONTENT_STYLES, 1)[0];

  const formatInstructions: Record<string, string> = {
    post: `–ù–∞–ø–∏—à–∏ –ü–û–°–¢ –¥–ª—è Instagram (2-3 –∫–æ—Ä–æ—Ç–∫–∏—Ö –∞–±–∑–∞—Ü–∞).
${writingRules}

–°—Ç—Ä—É–∫—Ç—É—Ä–∞:
1. –•—É–∫ ‚Äî –∑–∞—Ü–µ–ø–∏ —Å –ø–µ—Ä–≤–æ–≥–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è (–≤–æ–ø—Ä–æ—Å, –ø—Ä–æ–≤–æ–∫–∞—Ü–∏—è, –∏—Å—Ç–æ—Ä–∏—è)
2. –†–∞–∑–≤–∏—Ç–∏–µ ‚Äî —Ä–∞—Å–∫—Ä–æ–π —Ç–µ–º—É –∂–∏–≤—ã–º —è–∑—ã–∫–æ–º
3. –ü—Ä–∏–∑—ã–≤ ‚Äî —á—Ç–æ —Å–¥–µ–ª–∞—Ç—å (–∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ)`,

    carousel: `–ù–∞–ø–∏—à–∏ –ö–ê–†–£–°–ï–õ–¨ –∏–∑ 5-7 —Å–ª–∞–π–¥–æ–≤.
${writingRules}

–§–û–†–ú–ê–¢ –û–ë–Ø–ó–ê–¢–ï–õ–ï–ù:
–ü–µ—Ä–≤—ã–π —Å–ª–∞–π–¥ ‚Äî –∫—Ä—É–ø–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ (—Ö—É–∫, –∑–∞—Ü–µ–ø–∏—Ç—å –ª–∏—Å—Ç–∞—Ç—å)
–ó–∞—Ç–µ–º –∫–∞–∂–¥—ã–π –Ω–æ–≤—ã–π —Å–ª–∞–π–¥ –æ—Ç–¥–µ–ª—è–π —Å–∏–º–≤–æ–ª–∞–º–∏ ---
–ü–æ—Å–ª–µ–¥–Ω–∏–π —Å–ª–∞–π–¥ ‚Äî –ø—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é

–°–¢–†–£–ö–¢–£–†–ê (–ø—Ä–∏–¥—É–º–∞–π –°–í–û–Æ —Ç–µ–º—É –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∏—à–∏ "${niche}" –∏ –∏–¥–µ–∏):
[–ó–∞–≥–æ–ª–æ–≤–æ–∫-—Ö—É–∫ –Ω–∞ –ø–µ—Ä–≤–æ–º —Å–ª–∞–π–¥–µ]

---

[–ü—É–Ω–∫—Ç 1: —Ä–∞—Å–∫—Ä—ã—Ç–∏–µ —Ç–µ–º—ã]

---

[–ü—É–Ω–∫—Ç 2: –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ]

---

[–ü—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é]`,

    reels: `–ù–∞–ø–∏—à–∏ –°–¶–ï–ù–ê–†–ò–ô –¥–ª—è Reels/–≤–∏–¥–µ–æ.
${writingRules}

–í–´–ë–ï–†–ò –û–î–ò–ù –ò–ó –≠–¢–ò–• –§–û–†–ú–ê–¢–û–í –¥–ª—è —Ö—É–∫–∞ (–∏—Å–ø–æ–ª—å–∑—É–π –°–õ–£–ß–ê–ô–ù–û –≤—ã–±—Ä–∞–Ω–Ω—ã–π!):
${selectedReelsHooks.map((h, i) => `${i + 1}. ${h}`).join('\n')}

–°–¢–ò–õ–¨ –ü–û–î–ê–ß–ò (–≤—ã–±—Ä–∞–Ω —Å–ª—É—á–∞–π–Ω–æ): ${selectedReelsStyle}

–°—Ç—Ä—É–∫—Ç—É—Ä–∞:
'–•—É–∫: [–ø–µ—Ä–≤—ã–µ 3 —Å–µ–∫ ‚Äî –£–ù–ò–ö–ê–õ–¨–ù–´–ô, –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–π —à–∞–±–ª–æ–Ω—ã!]
–û—Å–Ω–æ–≤–∞: [–≥–ª–∞–≤–Ω–∞—è –º—ã—Å–ª—å, 20-30 —Å–µ–∫]
–ü—Ä–∏–∑—ã–≤: [—á—Ç–æ —Å–¥–µ–ª–∞—Ç—å]'

‚ö†Ô∏è –ó–ê–ü–†–ï–©–ï–ù–û: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã! –ö–∞–∂–¥—ã–π reels –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –£–ù–ò–ö–ê–õ–¨–ù–´–ú.
–ì–æ–≤–æ—Ä–∏ –æ—Ç –ø–µ—Ä–≤–æ–≥–æ –ª–∏—Ü–∞. –ö–∞–∫ –±—É–¥—Ç–æ —Å–Ω–∏–º–∞–µ—à—å —Å–∞–º–∞.`,

    stories: `–ù–∞–ø–∏—à–∏ —Å–µ—Ä–∏—é –∏–∑ 4-5 –°–¢–û–†–ò–°.
${writingRules}

–í–´–ë–ï–†–ò –û–î–ò–ù –ò–ó –≠–¢–ò–• –§–û–†–ú–ê–¢–û–í –¥–ª—è —Å–µ—Ä–∏–∏ (–∏—Å–ø–æ–ª—å–∑—É–π –°–õ–£–ß–ê–ô–ù–û –≤—ã–±—Ä–∞–Ω–Ω—ã–π!):
${selectedStoriesHooks.map((h, i) => `${i + 1}. ${h}`).join('\n')}

–°–¢–ò–õ–¨ –ü–û–î–ê–ß–ò (–≤—ã–±—Ä–∞–Ω —Å–ª—É—á–∞–π–Ω–æ): ${selectedStoriesStyle}

–§–æ—Ä–º–∞—Ç:
'–°—Ç–æ—Ä–∏—Å 1: [—Ç–µ–∫—Å—Ç –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏–µ]
–°—Ç–æ—Ä–∏—Å 2: [—Å–ª–µ–¥—É—é—â–∏–π —Å–ª–∞–π–¥]...'

‚ö†Ô∏è –ó–ê–ü–†–ï–©–ï–ù–û: –ø–æ–≤—Ç–æ—Ä—è—Ç—å –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã! –ö–∞–∂–¥–∞—è —Å–µ—Ä–∏—è –£–ù–ò–ö–ê–õ–¨–ù–ê.
–°—Ç–æ—Ä–∏—Å 1 ‚Äî –∑–∞—Ü–µ–ø–∏—Ç—å (–≤–æ–ø—Ä–æ—Å, –∏–Ω—Ç—Ä–∏–≥–∞, –ù–û –∫–∞–∂–¥—ã–π —Ä–∞–∑ –ø–æ-—Ä–∞–∑–Ω–æ–º—É!)
–ü–æ—Å–ª–µ–¥–Ω—è—è ‚Äî –ø—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é`
  };

  const callToAction = goal === "sale" 
    ? `–ú—è–≥–∫–æ –ø–æ–¥–≤–µ–¥–∏ –∫ –ø—Ä–æ–¥—É–∫—Ç—É "${product || '–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è'}". –ë–µ–∑ –¥–∞–≤–ª–µ–Ω–∏—è, —á–µ—Ä–µ–∑ –ø–æ–ª—å–∑—É.`
    : "–ü–æ–ø—Ä–æ—Å–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π, —Ä–µ–∞–∫—Ü–∏—é –∏–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ ‚Äî –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ, –Ω–µ –Ω–∞–≤—è–∑—á–∏–≤–æ.";

  const systemPrompt = `–¢—ã ‚Äî –∫–æ–ø–∏—Ä–∞–π—Ç–µ—Ä –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ –≤ –Ω–∏—à–µ "${niche}". –ü–∏—à–µ—à—å –∂–∏–≤—ã–º —è–∑—ã–∫–æ–º, –∫–∞–∫ –ø–æ–¥—Ä—É–≥–∞ –ø–æ–¥—Ä—É–≥–µ. –ù–∏–∫–∞–∫–æ–≥–æ –æ—Ñ–∏—Ü–∏–æ–∑–∞. –°–¢–†–û–ì–û –∏—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—é –Ω–∏—à–∏ "${niche}", –ù–ï –¥–æ–±–∞–≤–ª—è–π —ç–ª–µ–º–µ–Ω—Ç—ã –∏–∑ –¥—Ä—É–≥–∏—Ö –Ω–∏—à (—Ç–∞—Ä–æ, –∞—Å—Ç—Ä–æ–ª–æ–≥–∏—è, –Ω—É–º–µ—Ä–æ–ª–æ–≥–∏—è –∏ —Ç.–¥. –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ —É–∫–∞–∑–∞–Ω–æ –≤ –Ω–∏—à–µ).${genderInstruction}${archetypeInstruction}`;

  const randomSeed = Math.random().toString(36).substring(2, 10);

  const userPrompt = `SEED: ${randomSeed} (–∏—Å–ø–æ–ª—å–∑—É–π –¥–ª—è —Ä–∞–Ω–¥–æ–º–∏–∑–∞—Ü–∏–∏ –ø–æ–¥—Ö–æ–¥–∞!)

${formatInstructions[format]}

–ù–ò–®–ê: ${niche}
–¢–ò–ü: ${type}
–ò–î–ï–Ø: ${idea}
${callToAction}

‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –ü—Ä–∏–¥—É–º–∞–π –ü–û–õ–ù–û–°–¢–¨–Æ –£–ù–ò–ö–ê–õ–¨–ù–£–Æ –ø–æ–¥–∞—á—É! –ù–µ –∫–æ–ø–∏—Ä—É–π —à–∞–±–ª–æ–Ω–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã!

–û—Ç–≤–µ—Ç—å –¢–û–õ–¨–ö–û –≤–∞–ª–∏–¥–Ω—ã–º JSON –æ–±—ä–µ–∫—Ç–æ–º –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
{"content": "–≥–æ—Ç–æ–≤—ã–π —Ç–µ–∫—Å—Ç", "hashtags": ["#—Ç–µ–≥1", "#—Ç–µ–≥2"]}`;

  const maxRetries = 2;
  let lastError: any = null;
  
  for (let attempt = 1; attempt <= maxRetries; attempt++) {
    try {
      console.log(`Generating ${format} for idea: ${idea.substring(0, 50)}... (attempt ${attempt}/${maxRetries})`);
      const startTime = Date.now();
      
      const response = await getClient().chat.completions.create({
        model: "deepseek-chat",
        messages: [
          { role: "system", content: systemPrompt },
          { role: "user", content: userPrompt },
        ],
        temperature: 0.9,
        max_tokens: 2000,
        response_format: { type: "json_object" },
      });

      const elapsed = Date.now() - startTime;
      console.log(`${format} generated in ${elapsed}ms`);

      const content = response.choices[0]?.message?.content || "{}";
      console.log(`Raw ${format} response (first 300 chars):`, content.substring(0, 300));
      
      try {
        const parsed = JSON.parse(content);
        
        // Ensure we have the expected structure
        if (parsed.content) {
          return parsed as FormatContent;
        } else {
          // Try to extract from nested structure
          const jsonMatch = content.match(/\{[\s\S]*\}/);
          if (jsonMatch) {
            return JSON.parse(jsonMatch[0]) as FormatContent;
          }
          throw new Error("No content field found in response");
        }
      } catch (parseError: any) {
        console.error(`${format} JSON parse error:`, parseError.message);
        console.error("Response content:", content.substring(0, 300));
        throw new Error(`JSON parse failed: ${parseError.message}`);
      }
    } catch (error: any) {
      lastError = error;
      console.error(`${format} generation error (attempt ${attempt}):`, error?.message || error);
      
      if (attempt < maxRetries) {
        console.log("Retrying in 1 second...");
        await new Promise(resolve => setTimeout(resolve, 1000));
      }
    }
  }
  
  console.error(`All ${format} retry attempts failed`);
  throw lastError;
}
